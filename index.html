<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="keywords" content="Apple, Combine, ReactiveX, SwiftUI">
<meta name="author" content="Joseph Heck">
<meta name="copyright" content="Joseph Heck 2019">
<title>Using Combine</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Using Combine</h1>
<div class="details">
<span id="author" class="author">Joseph Heck</span><br>
<span id="revnumber">version 0.3,</span>
<span id="revdate">2019-07-07</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#aboutthisbook">About This Book</a>
<ul class="sectlevel2">
<li><a href="#supporting-this-effort">Supporting this effort</a></li>
<li><a href="#author-bio">Author Bio</a></li>
<li><a href="#where-to-get-this-book">Where to get this book</a>
<ul class="sectlevel3">
<li><a href="#download-the-project">Download the project</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#introduction">Introduction to Combine</a>
<ul class="sectlevel2">
<li><a href="#functional-reactive-programming">Functional reactive programming</a></li>
<li><a href="#combine-specifics">Combine specifics</a></li>
<li><a href="#when-to-use-combine">When to use Combine</a></li>
<li><a href="#apples-documentation">Apple&#8217;s Documentation</a>
<ul class="sectlevel3">
<li><a href="#wwdc-content">WWDC content</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#coreconcepts">Core Concepts</a>
<ul class="sectlevel2">
<li><a href="#core-publisher-subscriber">Publisher, Subscriber</a></li>
<li><a href="#core-lifecycle">Lifecycle of Publishers and Subscribers</a></li>
<li><a href="#core-publishers">Publishers</a></li>
<li><a href="#core-operators">Operators</a></li>
<li><a href="#core-subjects">Subjects</a></li>
<li><a href="#core-subscribers">Subscribers</a></li>
<li><a href="#core-types">Swift types and exposing pipelines or subscribers</a></li>
<li><a href="#core-threads">Pipelines and threads</a></li>
</ul>
</li>
<li><a href="#patterns">Patterns and Recipes</a>
<ul class="sectlevel2">
<li><a href="#patterns-sink-subscriber">Pattern 1.1: Creating a subscriber with sink</a></li>
<li><a href="#patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</a></li>
<li><a href="#patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</a></li>
<li><a href="#patterns-dataTaskPublisher-tryMap">Pattern 2.2: Stricter request processing with dataTaskPublisher</a></li>
<li><a href="#patterns-general-error-handling">Error Handling</a>
<ul class="sectlevel3">
<li><a href="#patterns-assertNoFailure">Pattern 3.1: verifying a failure hasn&#8217;t happened using assertNoFailure</a></li>
<li><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></li>
<li><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></li>
<li><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a></li>
</ul>
</li>
<li><a href="#patterns-constrained-network">Pattern 4: Requesting data from an alternate URL when the network is constrained</a></li>
<li><a href="#patterns-update-interface-network-request">Pattern 5: Update the status of your interface from a network request</a></li>
<li><a href="#patterns-future">Pattern 6: Wrapping an asynchronous call with a Future</a></li>
<li><a href="#patterns-sequencing-async">Pattern 7: Coordinating a sequence of asynchronous operations</a></li>
<li><a href="#patterns-published">Pattern 8: Responding to updates in properties with @Published</a></li>
<li><a href="#patterns-notificationcenter">Pattern 9: Responding to updates from NotificationCenter</a></li>
<li><a href="#patterns-bindableobject">Pattern 10: Using BindableObject with SwiftUI models as a publisher source</a></li>
<li><a href="#patterns-testing-pipeline">Pattern N.1: Testing pipelines</a></li>
<li><a href="#patterns-testing-publisher">Pattern N.2: Testing a publisher</a></li>
<li><a href="#patterns-testing-subscriber">Pattern N.3: Testing a subscriber</a></li>
<li><a href="#patterns-debugging">Pattern N+1: Debugging pipelines</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#reference-publishers">Publishers</a>
<ul class="sectlevel3">
<li><a href="#reference-just">Just</a></li>
<li><a href="#reference-future">Future</a></li>
<li><a href="#reference-published">Published</a></li>
<li><a href="#reference-empty">Publishers.Empty</a></li>
<li><a href="#reference-fail">Publishers.Fail</a></li>
<li><a href="#reference-once">Publishers.Once</a></li>
<li><a href="#reference-optional">Publishers.Optional</a></li>
<li><a href="#reference-sequence">Publishers.Sequence</a></li>
<li><a href="#reference-deferred">Publishers.Deferred</a></li>
<li><a href="#reference-swiftUI">SwiftUI</a></li>
<li><a href="#reference-foundation">Foundation</a></li>
<li><a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a></li>
<li><a href="#reference-realitykit">RealityKit</a></li>
</ul>
</li>
<li><a href="#reference-operators">Operators</a>
<ul class="sectlevel3">
<li><a href="#reference-operators-mapping">Mapping elements</a>
<ul class="sectlevel4">
<li><a href="#reference-scan">scan</a></li>
<li><a href="#reference-tryScan">tryScan</a></li>
<li><a href="#reference-map">map</a></li>
<li><a href="#reference-tryMap">tryMap</a></li>
<li><a href="#reference-flatMap">flatMap</a></li>
<li><a href="#reference-setFailureType">setFailureType</a></li>
</ul>
</li>
<li><a href="#reference-operators-filtering">Filtering elements</a>
<ul class="sectlevel4">
<li><a href="#reference-compactMap">compactMap</a></li>
<li><a href="#reference-tryCompactMap">tryCompactMap</a></li>
<li><a href="#reference-filter">filter</a></li>
<li><a href="#reference-tryFilter">tryFilter</a></li>
<li><a href="#reference-removeDuplicates">removeDuplicates</a></li>
<li><a href="#reference-tryRemoveDuplicates">tryRemoveDuplicates</a></li>
<li><a href="#reference-replaceEmpty">replaceEmpty</a></li>
<li><a href="#reference-replaceError">replaceError</a></li>
<li><a href="#reference-replaceNil">replaceNil</a></li>
</ul>
</li>
<li><a href="#reference-operators-reducing">Reducing elements</a>
<ul class="sectlevel4">
<li><a href="#reference-collect">collect</a></li>
<li><a href="#reference-collectByCount">collectByCount</a></li>
<li><a href="#reference-collectByTime">collectByTime</a></li>
<li><a href="#reference-ignoreOutput">ignoreOutput</a></li>
<li><a href="#reference-reduce">reduce</a></li>
<li><a href="#reference-tryReduce">tryReduce</a></li>
</ul>
</li>
<li><a href="#reference-operators-mathematical">Mathematic opertions on elements</a>
<ul class="sectlevel4">
<li><a href="#reference-max">max</a></li>
<li><a href="#reference-min">min</a></li>
<li><a href="#reference-comparison">comparison</a></li>
<li><a href="#reference-tryComparison">tryComparison</a></li>
<li><a href="#reference-count">count</a></li>
</ul>
</li>
<li><a href="#reference-operators-criteria">Applying matching criteria to elements</a>
<ul class="sectlevel4">
<li><a href="#reference-allSatisfy">allSatisfy</a></li>
<li><a href="#reference-tryAllSatisfy">tryAllSatisfy</a></li>
<li><a href="#reference-contains">contains</a></li>
<li><a href="#reference-containsWhere">containsWhere</a></li>
<li><a href="#reference-tryContainsWhere">tryContainsWhere</a></li>
</ul>
</li>
<li><a href="#reference-operators-sequence">Applying sequence operations to elements</a>
<ul class="sectlevel4">
<li><a href="#reference-first">first</a></li>
<li><a href="#reference-firstWhere">firstWhere</a></li>
<li><a href="#reference-tryFirstWhere">tryFirstWhere</a></li>
<li><a href="#reference-last">last</a></li>
<li><a href="#reference-lastWhere">lastWhere</a></li>
<li><a href="#reference-tryLastWhere">tryLastWhere</a></li>
<li><a href="#reference-dropUntilOutput">dropUntilOutput</a></li>
<li><a href="#reference-dropWhile">dropWhile</a></li>
<li><a href="#reference-tryDropWhile">tryDropWhile</a></li>
<li><a href="#reference-concatenate">concatenate</a></li>
<li><a href="#reference-drop">drop</a></li>
<li><a href="#reference-prefixUntilOutput">prefixUntilOutput</a></li>
<li><a href="#reference-prefixWhile">prefixWhile</a></li>
<li><a href="#reference-tryPrefixWhile">tryPrefixWhile</a></li>
<li><a href="#reference-output">output</a></li>
</ul>
</li>
<li><a href="#reference-operators-combinepublishers">Combining elements from multiple publishers</a>
<ul class="sectlevel4">
<li><a href="#reference-combineLatest">combineLatest</a></li>
<li><a href="#reference-tryCombineLatest">tryCombineLatest</a></li>
<li><a href="#reference-merge">merge</a></li>
<li><a href="#reference-zip">zip</a></li>
</ul>
</li>
<li><a href="#reference-operators-handlingErrors">Handling errors</a>
<ul class="sectlevel4">
<li><a href="#reference-catch">catch</a></li>
<li><a href="#reference-tryCatch">tryCatch</a></li>
<li><a href="#reference-assertNoFailure">assertNoFailure</a></li>
<li><a href="#reference-retry">retry</a></li>
<li><a href="#reference-mapError">mapError</a></li>
</ul>
</li>
<li><a href="#reference-operators-adaptingTypes">Adapting publisher types</a>
<ul class="sectlevel4">
<li><a href="#reference-switchToLatest">switchToLatest</a></li>
</ul>
</li>
<li><a href="#reference-operators-timing">Controlling timing</a>
<ul class="sectlevel4">
<li><a href="#reference-debounce">debounce</a></li>
<li><a href="#reference-delay">delay</a></li>
<li><a href="#reference-measureInterval">measureInterval</a></li>
<li><a href="#reference-throttle">throttle</a></li>
<li><a href="#reference-timeout">timeout</a></li>
</ul>
</li>
<li><a href="#reference-operators-coding">Encoding and decoding</a>
<ul class="sectlevel4">
<li><a href="#reference-encode">encode</a></li>
<li><a href="#reference-decode">decode</a></li>
</ul>
</li>
<li><a href="#reference-operators-multipleSubscribers">Working with multiple subscribers</a>
<ul class="sectlevel4">
<li><a href="#reference-multicast">multicast</a></li>
</ul>
</li>
<li><a href="#reference-operators-debugging">Debugging</a>
<ul class="sectlevel4">
<li><a href="#reference-breakpoint">breakpoint</a></li>
<li><a href="#reference-breakpointOnError">breakpointOnError</a></li>
<li><a href="#reference-handleEvents">handleEvents</a></li>
<li><a href="#reference-print">print</a></li>
</ul>
</li>
<li><a href="#scheduler-and-thread-handling-operators">Scheduler and Thread handling operators</a>
<ul class="sectlevel4">
<li><a href="#reference-receive">receive</a></li>
<li><a href="#reference-subscribe">subscribe</a></li>
</ul>
</li>
<li><a href="#type-erasure-operators">Type erasure operators</a>
<ul class="sectlevel4">
<li><a href="#reference-eraseToAnyPublisher">eraseToAnyPublisher</a></li>
<li><a href="#reference-eraseToAnySubscriber">eraseToAnySubscriber</a></li>
<li><a href="#reference-eraseToAnySubject">eraseToAnySubject</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reference-subjects">Subjects</a>
<ul class="sectlevel3">
<li><a href="#reference-currentValueSubject">currentValueSubject</a></li>
<li><a href="#reference-passthroughSubject">PassthroughSubject</a></li>
</ul>
</li>
<li><a href="#reference-subscribers">Subscribers</a>
<ul class="sectlevel3">
<li><a href="#reference-assign">assign</a></li>
<li><a href="#reference-sink">sink</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="aboutthisbook">About This Book</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="supporting-this-effort">Supporting this effort</h3>
<div class="paragraph">
<p><strong><em>This is a work in progress.</em></strong></p>
</div>
<div class="paragraph">
<p>The book is being made available at no cost.
The content for this book, including sample code and tests is available on GitHub at <a href="https://github.com/heckj/swiftui-notes" class="bare">https://github.com/heckj/swiftui-notes</a>.</p>
</div>
<div class="paragraph">
<p>If you want to report a problem (typo, grammar, or technical fault), please <a href="https://github.com/heckj/swiftui-notes/issues/new/choose">Open an issue</a> in GitHub.
If you are so inclined, feel free to fork the project and send me <a href="https://github.com/heckj/swiftui-notes/compare?expand=1">pull requests</a> with updates or corrections.</p>
</div>
<div class="paragraph">
<p>I am working through how to make it available to the widest audience while also generating a small amount of money to support the creation of this book, from technical authoring and review through copy editing.</p>
</div>
</div>
<div class="sect2">
<h3 id="author-bio">Author Bio</h3>
<div class="paragraph">
<p>Joe Heck has broad software engineering development and management experience crossing startups and large companies.
He works across all the layers of solutions, from architecture, development, validation, deployment, and operations.</p>
</div>
<div class="paragraph">
<p>Joe has developed projects ranging from mobile and desktop application development to cloud-based distributed systems.
He has established teams, development processes, CI and CD pipelines, and developed validation and operational automation.
Joe also builds and mentors people to learn, build, validate, deploy and run software services and infrastructure.</p>
</div>
<div class="paragraph">
<p>Joe works extensively with and in open source, contributing and collaborating with a wide variety of open source projects.
He writes online across a variety of topics at <a href="https://rhonabwy.com/" class="bare">https://rhonabwy.com/</a>.</p>
</div>
<table class="tableblock frame-none grid-none" style="width: 50%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="https://github.com/heckj"><span class="icon"><i class="fa fa-github fa-2x"></i></span></a></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="https://www.linkedin.com/in/josephheck/"><span class="icon"><i class="fa fa-linkedin fa-2x"></i></span></a></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="http://twitter.com/heckj"><span class="icon"><i class="fa fa-twitter fa-2x"></i></span></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="where-to-get-this-book">Where to get this book</h3>
<div class="paragraph">
<p>The contents of this book are available as <a href="https://heckj.github.io/swiftui-notes/">HTML</a>, <a href="https://heckj.github.io/swiftui-notes/using-combine-book.pdf">PDF</a>, and <a href="https://heckj.github.io/swiftui-notes/using-combine-book.epub">ePub</a>.</p>
</div>
<div class="paragraph">
<p>There is also an Xcode project (<code>SwiftUI-Notes.xcodeproj</code>) <a href="https://github.com/heckj/swiftui-notes">available on GitHub</a>.
The project includes tests, snippets, and trials used in creating this work.</p>
</div>
<div class="sect3">
<h4 id="download-the-project">Download the project</h4>
<div class="paragraph">
<p>The project associated with this book requires Xcode v11 (which has been released as beta3 as of this writing) and MacOS 10.14 or later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/welcomeToXcode.png" alt="Welcome to Xcode" width="406" height="388">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>From the Welcome to Xcode window, choose <strong>Clone an existing project</strong></p>
</li>
<li>
<p>Enter <code><a href="https://github.com/heckj/swiftui-notes.git" class="bare">https://github.com/heckj/swiftui-notes.git</a></code> and click <code>Clone</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloneRepository.png" alt="clone Repository" width="463" height="263">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose the <code>master</code> branch to check out</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction to Combine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Apple&#8217;s words, Combine is:</p>
</div>
<div class="quoteblock">
<blockquote>
a declarative Swift API for processing values over time.
</blockquote>
</div>
<div class="paragraph">
<p>Combine is Apple&#8217;s take on a functional reactive programming library, akin to <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a>.
RxSwift itself is a port of <a href="http://reactivex.io">ReactiveX</a>.
Apple&#8217;s framework uses many of the same functional reactive concepts that can be found in other languages and libraries, applying the staticly-typed nature of Swift to their solution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are already familar with RxSwift there is <a href="https://medium.com/gett-engineering/rxswift-to-apples-combine-cheat-sheet-e9ce32b14c5b">a pretty good cheat-sheet for translating the specifics between Rx and Combine</a>,
built and inspired by the data collected at
<a href="https://github.com/freak4pc/rxswift-to-combine-cheatsheet" class="bare">https://github.com/freak4pc/rxswift-to-combine-cheatsheet</a>.</p>
</div>
<div class="paragraph">
<p>Another good over is a post <a href="https://www.caseyliss.com/2019/6/17/combine-wheres-the-beef">Combine: Where&#8217;s the Beef?</a> by Casey Liss describing how Combine maps back to RxSwift and RxCocoa&#8217;s concepts, and where it is different.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="functional-reactive-programming">Functional reactive programming</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Functional_reactive_programming">Functional reactive programming</a>, also known as data-flow programming, builds on the concepts of <a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming</a>.
Where functional programming applies to lists of elements, functional reactive programming is applied to streams of elements.
The kinds of functions in functional programming, such as <code>map</code>, <code>filter</code>, and <code>reduce</code> all have analogues that can be applied to streams.
In addition, functional reactive programming includes functions to split streams, create pipelines of operations to transform the data within a stream, and merge streams.</p>
</div>
<div class="paragraph">
<p>There are many parts of the systems we program that can be viewed as asynchronous streams of information - events, objects, or pieces of data.
Programming practices defined the Observer pattern for watching a single object, getting notified of changes and updates.
If you view this over time, these updates make up a stream of objects.
Functional reactive programming, or Combine in this case, allows you to create code that describes what happens when getting data in a stream.</p>
</div>
<div class="paragraph">
<p>You may want to create logic to watch more than one element that is changing.
You may also want to include logic that does additional asynchronous operations, some of which may fail.
You may also want to change the content of the streams based on timing, or change the timing of the content.
Handling the flow of these event streams, the timing, errors when they happen, and coordinating how a system responds to all those events is at the heart of this kind of programming.</p>
</div>
<div class="paragraph">
<p>A solution based on functional reactive programming is particularly effective when programming user interfaces.
Or more generally for creating pipelines that process data from external sources or rely on asynchronous APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="combine-specifics">Combine specifics</h3>
<div class="paragraph">
<p>Applying these concepts to a strongly typed language like swift is part of what Apple has created in Combine.
Combine embeds the concept of back-pressure, which allows the subscriber to control how much information it gets at once and needs to process.
In addition, it supports efficient operation with the notion of streams that are cancellable and driven primarily by the subscriber.</p>
</div>
<div class="paragraph">
<p>Combine is set up to be composed, and includes affordances to integrate existing code to incrementally support adoption.</p>
</div>
<div class="paragraph">
<p>Combine is supported by a couple of Apple&#8217;s other frameworks.
SwiftUI is the obvious example that has the most attention, with both subscriber and publisher elements.
RealityKit also has publishers that you can use to react to events.
And Foundation has a number of Combine specific additions including NotificationCenter, URLSession, and Timer as publishers.</p>
</div>
<div class="paragraph">
<p>Any asynchronous operation API <em>can</em> be leveraged with Combine.
For example, you could use some of the APIs in the Vision framework, composing data flowing to it, and from it, by leveraging Combine.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>In this work, I&#8217;m going to call a set of composed operations in Combine a <strong>pipeline</strong>.
Pipeline is not a term that Apple is (yet?) using in its documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="when-to-use-combine">When to use Combine</h3>
<div class="paragraph">
<p>Combine fits most naturally when you want to set up a something that is "immediately" reactive to a variety of inputs.
User interfaces fit very naturally into this pattern.</p>
</div>
<div class="paragraph">
<p>The classic examples in functional reactive programming and user interfaces frequently show form validation, where user events such as changing text fields, taps, or mouse-clicks on UI elements make up the data being streamed.
Combine takes this quite a bit further, enabling watching of properties, binding to objects, sending and receiving higher level events from UI controls, and supporting integration with almost all of Apple&#8217;s existing API ecosystem.</p>
</div>
<div class="paragraph">
<p>Some things you can do with Combine include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can set up pipelines to enable the button for submission only when values entered into the fields are valid.</p>
</li>
<li>
<p>A pipeline can also do asynchronous actions (such as checking with a network service) and using the values returned to choose how and what to update within a view.</p>
</li>
<li>
<p>Pipelines can also be used to react to a user typing dynamically into a text field and updating the user interface view based on what they&#8217;re typing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Combine is not limited to user interfaces.
Any sequence of asynchronous operations can be effective as a pipeline, especially when the results of each step flow to the next step.
An example of such might be a series of network service requests, followed by decoding the results.</p>
</div>
<div class="paragraph">
<p>Combine can also be used to define how to handle errors from asynchronous operations.
Combine supports doing this by setting up pipelines and merging them together.
One of Apple&#8217;s examples with Combine include a pipeline to fall back to getting a lower-resolution image from a network service when the local network is constrained.</p>
</div>
<div class="paragraph">
<p>Many of the pipelines you create with Combine will only be a few operations.
Even with just a few operations, Combine can still make it much easier to view and understand what&#8217;s happening when you compose a pipeline.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="apples-documentation">Apple&#8217;s Documentation</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-apple fa-2x"></i></span></p>
</div>
<div class="paragraph">
<p>The <a href="https://developer.apple.com/documentation/combine">online documentation for Combine</a> can be found at <a href="https://developer.apple.com/documentation/combine" class="bare">https://developer.apple.com/documentation/combine</a>.
Apple&#8217;s developer documentation is hosted at <a href="https://developer.apple.com/documentation/" class="bare">https://developer.apple.com/documentation/</a>.</p>
</div>
<div class="sect3">
<h4 id="wwdc-content">WWDC content</h4>
<div class="paragraph">
<p>Apple provides video, slides, and some sample code in sessions it&#8217;s developer conferences.
Details on Combine are primarily from <a href="https://developer.apple.com/videos/play/wwdc2019">WWDC 2019</a>.</p>
</div>
<div class="paragraph">
<p>A number of these introduce and go into some depth on Combine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2019/722l6blhn0efespfgx/722/722_introducing_combine.pdf?dl=1">PDF of presentation notes</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2019/721ga0kflgr4ypfx/721/721_combine_in_practice.pdf?dl=1">PDF of presentation notes</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A number of additional WWDC19 sessions mention Combine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coreconcepts">Core Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="core-publisher-subscriber">Publisher, Subscriber</h3>
<div class="paragraph">
<p>Two key concepts, described in swift with protocols, are <a href="https://developer.apple.com/documentation/combine/publisher"><strong>publisher</strong></a> and <a href="https://developer.apple.com/documentation/combine/subscriber"><strong>subscriber</strong></a>.</p>
</div>
<div class="paragraph">
<p>A publisher provides data.
It is described with two associated types: one for Output and one for Failure.
A subscriber requests data.
It is also described with two associated types, one for Input and one for Failure.
When you connect a subscriber to a publisher, both types must match: Output to Input, and Failure to Failure.
You can view this as a series of operations on two types in parallel.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Publisher source       Subscriber
+--------------+      +--------------+
|        &lt;Output&gt; --&gt; &lt;Input&gt;        |
|       &lt;Failure&gt; --&gt; &lt;Failure&gt;      |
+--------------+      +--------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Operators are classes that adopt both the <a href="https://developer.apple.com/documentation/combine/subscriber">Subscriber protocol</a> and <a href="https://developer.apple.com/documentation/combine/publisher">Publisher protocol</a>.
They support subscribing to a publisher, and sending results to any subscribers.</p>
</div>
<div class="paragraph">
<p>You can create chains of these together, for processing, reacting, and transforming the data provided by a publisher, and requested by the subscriber.</p>
</div>
<div class="paragraph">
<p>I&#8217;m calling these composed sequences <strong>pipelines</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Publisher source       Operator                          Subscriber
+--------------+      +---------------------------+      +--------------+
|        &lt;Output&gt; --&gt; &lt;Input&gt;      map      &lt;Output&gt; --&gt; &lt;Input&gt;        |
|       &lt;Failure&gt; --&gt; &lt;Failure&gt;  function  &lt;Failure&gt; --&gt; &lt;Failure&gt;      |
+--------------+      +---------------------------+      +--------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Operators can be used to transform types - both the Output and Failure type.
Operators may also split or duplicate streams, or merge streams together.
Operators must always be aligned by the combination of Output/Failure types.
The compiler will enforce the matching types, so getting it wrong will result in a compiler error (and sometimes a useful <em>fixit</em> snippet.)</p>
</div>
<div class="paragraph">
<p>A simple pipeline, using Combine, might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="c1">// do something with the incoming value here</span>
        <span class="c1">// and return a string</span>
        <span class="k">return</span> <span class="s">"a string"</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="c1">// sink is the subscriber and terminates the pipeline</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The pipeline starts with the publisher <code>Just</code>, which responds with the value that its defined with (in this case, the Integer <code>5</code>). The output type is &lt;Integer&gt;, and the failure type is &lt;Never&gt;.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the pipeline then has a <code>map</code> operator, which is transforming the value. In this example it is ignoring the published input and returning a string. This is also transforming the output type to &lt;String&gt;, and leaving the failure type still set as &lt;Never&gt;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The pipeline then ends with a <code>sink</code> subscriber.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are viewing a pipeline, or creating one, you can think of it as a sequence of operations linked by the types.
This pattern will come in handy when you start constructing your own pipelines.
When creating pipelines, you are often selecting operators to help you transform the types, to achieve your end goal.
That end goal might be enabling or disabling a user interface element, or it might be retrieving some piece of data to be displayed.</p>
</div>
<div class="paragraph">
<p>Many combine operators are specifically created to help with these transformations.
Some operators require conformance to an input or failure type.
Other operators may change either or both the failure and output types.
For example, there are a number of operators that have a similar operator prefixed with <code>try</code>, which indicates they return an &lt;Error&gt; failure type.</p>
</div>
<div class="paragraph">
<p>An example of this is <a href="#reference-map">map</a> and <a href="#reference-tryMap">tryMap</a>.
The <code>map</code> operator allows for any combination of Output and Failure type and passes them through.
<code>tryMap</code> accepts any Input, Failure types, and allows any Output type, but will always output an <code>&lt;Error&gt;</code> failure type.</p>
</div>
<div class="paragraph">
<p>Operators like <code>map</code> allow you to define the output type being returned by infering the type based on what you return in a closure provided to the operator.
In the example above, the <code>map</code> operator is returning a String output type since that it what the closure returns.</p>
</div>
<div class="paragraph">
<p>To illustrate the the example of changing types more concretely, we expand upon the logic to use the values being passed. This example still starts with a publisher providing the types <code>&lt;Int&gt;</code>, <code>&lt;Never&gt;</code> and end with a subscription taking the types <code>&lt;String&gt;</code>, <code>&lt;Never&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">switch</span> <span class="n">value</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"none"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"one"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"couple"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"few"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"many"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"some"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just is a publisher that creates an <code>&lt;Int&gt;</code>, <code>&lt;Never&gt;</code> type combination, provides a single value and then completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the closure provided to the <code>.map()</code> function takes in an <code>&lt;Int&gt;</code> and transforms it into a <code>&lt;String&gt;</code>. Since the failure type of &lt;Never&gt; is not changed, it is passed through.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>sink</code>, the subscriber, receives the <code>&lt;String&gt;</code>, <code>&lt;Never&gt;</code> combination.</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>When you are creating pipelines in Xcode and don&#8217;t match the types, the error message from Xcode may include a helpful <em>fixit</em>.
In some cases, such as the example above, the compiler is unable to infer the return types of closure provided to <code>map</code> withpout specifying the return type.
Xcode (11 beta 2 and beta 3) displays this as the error message: <code>Unable to infer complex closure return type; add explicit type to disambiguate</code>.
In the example above, we explicitly specified the type being returned with the line <code>value &#8594; String in</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>You can view Combine publishers, operators, and subscribers as having two parallel types that both need to be aligned - one for the functional case and one for the error case.
Designing your pipeline is frequently choosing how to convert one or both of those types and the associated data with it.</p>
</div>
<div class="paragraph">
<p>More examples, and some common tasks, are detailed in the <a href="#patterns">section on patterns</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="core-lifecycle">Lifecycle of Publishers and Subscribers</h3>
<div class="paragraph">
<p>The data flow in Combine is driven by, and starts from, the subscriber.
This is how Combine supports the concept of back pressure.</p>
</div>
<div class="paragraph">
<p>Internally, Combine supports this with the enumeration <a href="https://developer.apple.com/documentation/combine/subscribers/demand">Demand</a>.
When a subscriber is communicating with a publisher, it requests data based on demand.
This request is what drives calling all the closures up the composed pipeline.</p>
</div>
<div class="paragraph">
<p>Because subscribers drive the closure execution, it also allows Combine to support cancellation.
Cancellation can be triggered by the subscriber.</p>
</div>
<div class="paragraph">
<p>This is all enabled by subscribers and publishers communicating in a well defined sequence, or lifecycle.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the subscriber is attached to a publisher, it starts with a call to <code>.subscribe(Subscriber)</code>.</p>
</li>
<li>
<p>The publisher in turn acknowledges the subscription calling <code>receive(subscription)</code>.</p>
<div class="ulist">
<ul>
<li>
<p>After the subscription has been acknowledged, the subscriber requests <em>N</em> values with <code>request(_ : Demand)</code>.</p>
</li>
<li>
<p>The publisher may then (as it has values) sending <em>N</em> (or fewer) values: <code>receive(_ : Input)</code>.
A publisher should never send <strong>more</strong> than the demand requested.</p>
</li>
<li>
<p>Also after the subscription has been acknowledged, the subscriber can send a <a href="https://developer.apple.com/documentation/combine/subscribers/completion">cancellation</a> with <code>.cancel()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>A publisher may optionally send <a href="https://developer.apple.com/documentation/combine/subscribers/completion">completion</a>: <code>receive(completion:)</code> which is also how errors are propogated.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="core-publishers">Publishers</h3>
<div class="paragraph">
<p>The publisher is the provider of data.
The <a href="https://developer.apple.com/documentation/combine/publisher">publisher protocol</a> has a strict contract returning values when asked from subscribers, and possibly terminating with an explicit completion enumeration.</p>
</div>
<div class="paragraph">
<p><a href="#reference-just">Just</a> and <a href="#reference-future">Future</a> are extremely common sources to start your own publisher from a value or function.
Combine provides a number of additional convenience publishers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-just">Just</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-future">Future</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-published">Published</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-once">Publishers.Once</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-optional">Publishers.Optional</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-sequence">Publishers.Sequence</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-empty">Publishers.Empty</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-fail">Publishers.Fail</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-deferred">Publishers.Deferred</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A number of Apple APIs outside of Combine provide publishers as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SwiftUI provides <a href="https://developer.apple.com/documentation/swiftui/objectbinding"><code>@ObjectBinding</code></a> which can be used to create a publisher.</p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/notificationcenter"><code>NoticationCenter</code></a> <a href="https://developer.apple.com/documentation/foundation/notificationcenter/3329353-publisher"><code>.publisher</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/timer"><code>Timer</code></a> <a href="https://developer.apple.com/documentation/foundation/notificationcenter/3329353-publisher"><code>.publish</code></a> and <a href="https://developer.apple.com/documentation/foundation/timer/timerpublisher"><code>Timer.TimerPublisher</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/urlsession"><code>URLSession</code></a> <a href="https://developer.apple.com/documentation/foundation/urlsession/3329707-datataskpublisher"><code>dataTaskPublisher</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit"><code>RealityKit</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene"><code>.Scene</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene/3254685-publisher"><code>.publisher()</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="core-operators">Operators</h3>
<div class="paragraph">
<p>Operators are a convenient name for a number of pre-built functions that are included under Publisher in Apple&#8217;s reference documentation.
These functions are all meant to be composed into pipelines.
Many will accept  one of more closures from the developer to define the business logic of the operator, while maintaining the adherance to the publisher/subscriber lifecycle.</p>
</div>
<div class="paragraph">
<p>Some operators support bringing together outputs from different pipelines, or splitting to send to multiple subscribers.
Operators may also have constraints on the types they will operate on.
Operators can also help with error handling and retry logic, buffering and prefetch, controlling timing, and supporting debugging.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Mapping elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-scan">scan</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryScan">tryScan</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-setFailureType">setFailureType</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-map">map</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryMap">tryMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-flatMap">flatMap</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Filtering elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-compactMap">compactMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryCompactMap">tryCompactMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-replaceEmpty">replaceEmpty</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-filter">filter</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryFilter">tryFilter</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-replaceError">replaceError</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-removeDuplicates">removeDuplicates</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryRemoveDuplicates">tryRemoveDuplicates</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Reducing elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-collect">collect</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-collectByCount">collectByCount</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-collectByTime">collectByTime</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-reduce">reduce</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryReduce">tryReduce</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-ignoreOutput">ignoreOutput</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Mathematic opertions on elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-comparison">comparison</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryComparison">tryComparison</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-count">count</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Applying matching criteria to elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-allSatisfy">allSatisfy</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryAllSatisfy">tryAllSatisfy</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-contains">contains</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-containsWhere">containsWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryContainsWhere">tryContainsWhere</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Applying sequence operations to elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-firstWhere">firstWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryFirstWhere">tryFirstWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-first">first</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-lastWhere">lastWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryLastWhere">tryLastWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-last">last</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-dropWhile">dropWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryDropWhile">tryDropWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-dropUntilOutput">dropUntilOutput</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-concatenate">concatenate</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-drop">drop</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-prefixUntilOutput">prefixUntilOutput</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-prefixWhile">prefixWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryPrefixWhile">tryPrefixWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-output">output</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Combining elements from multiple publishers</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-combineLatest">combineLatest</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryCombineLatest">tryCombineLatest</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-merge">merge</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-zip">zip</a></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Handling errors</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-catch">catch</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryCatch">tryCatch</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-assertNoFailure">assertNoFailure</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-retry">retry</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-mapError">mapError</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Adapting publisher types</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-switchToLatest">switchToLatest</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-eraseToAnyPublisher">eraseToAnyPublisher</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Controlling timing</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-debounce">debounce</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-delay">delay</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-measureInterval">measureInterval</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-throttle">throttle</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-timeout">timeout</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Encoding and decoding</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-encode">encode</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-decode">decode</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Working with multiple subscribers</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-multicast">multicast</a></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Debugging</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-breakpoint">breakpoint</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-handleEvents">handleEvents</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-print">print</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="core-subjects">Subjects</h3>
<div class="paragraph">
<p>Subjects are a special case of publisher that also adhere to the <a href="https://developer.apple.com/documentation/combine/subject"><code>subject</code></a> protocol.
This protocol requires subjects to have a <code>.send()</code> method to allow the developer to send specific values to a subscriber (or pipeline).</p>
</div>
<div class="paragraph">
<p>Subjects can be used to "inject" values into a stream, by calling the subject&#8217;s <code>.send()</code> method.
This is useful for integrating existing imperative code with Combine.</p>
</div>
<div class="paragraph">
<p>A subject can also broadcast values to multiple subscribers.
If multiple subscribers are connected to a subject, it will fanning out values to the multiple subscribers when <code>send()</code> is invoked.</p>
</div>
<div class="paragraph">
<p>There are two built-in subjects with Combine:</p>
</div>
<div class="paragraph">
<p>The first is <a href="#reference-currentValueSubject">currentValueSubject</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CurrentValue remembers the current value so that when a subscriber is attached, it immediately receives the current value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is created and initialized with an initial value.
When a subscriber is connected to it and requests data, the initial value is sent.
Further calls to <code>.send()</code> afterwards will then send those values to any subscribers.</p>
</div>
<div class="paragraph">
<p>The second is <a href="#reference-passthroughSubject">PassthroughSubject</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Passthrough doesn&#8217;t maintain any state - just passes through provided values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When it is created, only the types are defined.
When a subscriber is connected and requests data, it will not receive any values until a <code>.send()</code> call is invoked.
Calls to <code>.send()</code> will then send values to any subscribers.</p>
</div>
<div class="paragraph">
<p>PassthroughSubject is extremely useful when writing tests for pipelines, as sending of any requested data (or a failure) is under the test writer&#8217;s control using the <code>.send()</code> function.</p>
</div>
<div class="paragraph">
<p>Both CurrentValueSubject and PassthroughSubject are also useful for creating publishers from objects conforming to the <a href="https://developer.apple.com/documentation/swiftui/bindableobject"><code>BindableObject</code></a> protocol within SwiftUI.</p>
</div>
</div>
<div class="sect2">
<h3 id="core-subscribers">Subscribers</h3>
<div class="paragraph">
<p>While <a href="https://developer.apple.com/documentation/combine/subscriber"><code>subscriber</code></a> is the protocol used to receive data throughout a pipeline, <em>the Subscriber</em> typically refers to the end of a pipeline.</p>
</div>
<div class="paragraph">
<p>There are two subscribers built-in to Combine: assign and sink.</p>
</div>
<div class="paragraph">
<p>Subscribers can support cancellation, which terminates a subscription and shuts down all the stream processing prior to any Completion sent by the publisher.
Both <code>Assign</code> and <code>Sink</code> conform to the <a href="https://developer.apple.com/documentation/combine/cancellable">cancellable protocol</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/combine/subscribers/assign"><code>assign</code></a> applies values passed down from the publisher to an object defined by a keypath.
The keypath is set when the pipeline is created.
An example of this in swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">signupButton</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/combine/subscribers/sink"><code>sink</code></a> accepts a closure that receives any resulting values from the publisher.
This allows the developer to terminate a pipeline with their own code.
This subscriber is also extremely helpful when writing unit tests to validate either publishers or pipelines.
An example of this in swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">receivedValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Most other subscribers are part of other Apple frameworks.
For example, nearly every control in SwiftUI can act as a subscriber.
The <a href="https://developer.apple.com/documentation/swiftui/view/3278619-onreceive"><code>.onReceive(publisher)</code></a> function is used on SwiftUI views to act as a subscriber, taking a closure akin to <code>.sink()</code> that can manipulate <code>@State</code> or <code>@Bindings</code> within SwiftUI.</p>
</div>
<div class="paragraph">
<p>An example of that in swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">MyView</span> <span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>

    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">currentStatusValue</span> <span class="o">=</span> <span class="s">"ok"</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Current status: </span><span class="se">\(</span><span class="n">currentStatusValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="kt">MyPublisher</span><span class="o">.</span><span class="n">currentStatusPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="n">newStatus</span> <span class="k">in</span>
        <span class="n">currentStatusValue</span> <span class="o">=</span> <span class="n">newStatus</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any type of UI object (UIKit, AppKit, or SwiftUI), <code>.assign</code> can be used with pipelines to manipulate properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="core-types">Swift types and exposing pipelines or subscribers</h3>
<div class="paragraph">
<p>When you compose pipelines within swift, the chaining is interpretted as nesting generic types to the compiler.
If you expose a pipeline as a publisher, subscriber, or subject the exposed type can be exceptionally complex.</p>
</div>
<div class="paragraph">
<p>For example, if you created a publisher from a PassthroughSubject such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">name</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
            <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
            <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="kt">Just</span><span class="p">(</span><span class="s">"No user found"</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
                <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s"> foo"</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting type would reflect that composition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kt">Publishers</span><span class="o">.</span><span class="kt">FlatMap</span><span class="o">&lt;</span><span class="kt">Publishers</span><span class="o">.</span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">Publishers</span><span class="o">.</span><span class="kt">Catch</span><span class="o">&lt;</span><span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">Just</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to expose the code, all of that composition detail can be very distracting and make your publisher, subject, or subscriber) harder to use.
To clean up that interface, and provide a nice API boundary, the three major protocols all support methods that do type erasure.
This cleans up the exposed type to a simpler generic form.</p>
</div>
<div class="paragraph">
<p>These three methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publisher/3241548-erasetoanypublisher"><code>.eraseToAnyPublisher()</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/subscriber/3241649-erasetoanysubscriber"><code>.eraseToAnySubscriber()</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/subject/3241648-erasetoanysubject"><code>.eraseToAnySubject()</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you updated the above code to add .eraseToAnyPublisher() at the end of the pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">name</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
            <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
            <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="kt">Just</span><span class="p">(</span><span class="s">"No user found"</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
                <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s"> foo"</span>
        <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting type would simplify to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core-threads">Pipelines and threads</h3>
<div class="paragraph">
<p>Combine is not just a single threaded construct.
Combine allows for publishers to specify the scheduler used when either receiving from an upstream publisher (in the case of operators), or when sending to a downstream subscriber.
This is critical when working with a subscriber that updates UI elements, as that should always be called on the main thread.</p>
</div>
<div class="paragraph">
<p>You may see this in code as an operator, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift">    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="patterns">Patterns and Recipes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Included are a series of patterns and examples of Publishers, Subscribers, and pipelines.
These examples are meant to illustrate how to use the Combine framework to accomplish various tasks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Since this is a work in progress:</em>
if you have a suggestion for a pattern or recipe, I&#8217;m happy to consider it.</p>
</div>
<div class="paragraph">
<p>Please <a href="https://github.com/heckj/swiftui-notes/issues/new/choose">Open an issue</a> in GitHub to request something.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="patterns-sink-subscriber">Pattern 1.1: Creating a subscriber with sink</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To receive the output, and the errors or completion messages, generated from a publisher or through a pipeline, you can create a subscriber with <code>sink</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</a></p>
</li>
<li>
<p><a href="#patterns-testing-publisher">Pattern N.2: Testing a publisher</a></p>
</li>
<li>
<p><a href="#patterns-testing-pipeline">Pattern N.1: Testing pipelines</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Sink creates an all-purpose subscriber to capture or react the data from a Combine pipeline, while also supporting cancellation and the <a href="#core-lifecycle">publisher subscriber lifecycle</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">simple sink</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="c1">// do what you want with the resulting value passed down</span>
    <span class="c1">// be aware that depending on the data type being returned, you may get this closure invoked</span>
    <span class="c1">// multiple times.</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The simple version of a sink is very compact, with a single trailing closure that only receives data when presented through the pipeline.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">sink with completions and data</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span>
        <span class="c1">// no associated data, but you can react to knowing the request has been completed</span>
        <span class="k">break</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span>
        <span class="c1">// do what you want with the error details, presenting, logging, or hiding as appropriate</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"received the error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
    <span class="c1">// do what you want with the resulting value passed down</span>
    <span class="c1">// be aware that depending on the data type being returned, you may get this closure invoked</span>
    <span class="c1">// multiple times.</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">cancellablePipeline</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sinks are created by chaining the code from a publisher or pipeline, and terminate the pipeline.
When the sink is created or invoked on a publisher, it implicitly starts <a href="#core-lifecycle">the lifecycle</a> with the <code>subscribe</code> and will request unlimited data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating a sink is cancellable subscriber, so at any time you can take the reference that terminated with sink and invoke <code>.cancel()</code> on it to invalidate and shut down the pipeline.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To use the results of a pipeline to set a value, often a property on a user interface view or control, but any KVO compliant object can be the target</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-assign">assign</a></p>
</li>
<li>
<p><a href="#reference-receive">receive</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-sink-subscriber">Pattern 1.1: Creating a subscriber with sink</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Assign is a subscriber that&#8217;s specifically designed to apply data from a publisher or pipeline into a property, updating that property whenever it receives data.
Like sink, it activates when created and requests an unlimited data updates.
Assign requires the failure type to be specified as <code>&lt;Never&gt;</code>, so if your pipeline could fail (such as using an operator like tryMap) you will need to <a href="#patterns-general-error-handling">convert or handle the the failure cases</a> before using <code>.assign</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">simple sink</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourButton</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="n">cancellablePipeline</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>.assign</code> is typically chained onto a publisher when you create it, and the return value is cancellable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If <code>.assign</code> is being used to update a user interface element, you need to make sure that it is being updated on the main thread. This call makes sure the subscriber is received on the main thread.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assign references the property being updated using a <a href="https://developer.apple.com/documentation/swift/referencewritablekeypath">key path</a>, and a reference to the object being updated.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>At any time you can can to terminate and invalidate pipelines with cancel(). Frequently, you cancel the pipelines when you deactivate the objects (such as a viewController) that are getting updated from the pipeline.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>One of the common use cases is requesting JSON data from a URL and decoding it.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-map">map</a></p>
</li>
<li>
<p><a href="#reference-decode">decode</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
<li>
<p><a href="#reference-subscribe">subscribe</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-tryMap">Pattern 2.2: Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>This can be readily accomplished with Combine using
<a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a> followed by a series of operators that process the
data.
Minimally, this is <a href="#reference-map">map</a> and <a href="#reference-decode">decode</a> before going into your subscriber.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/foundation/urlsession/3329708-datataskpublisher">dataTaskPublisher</a> on <a href="https://developer.apple.com/documentation/foundation/urlsession">URLSession</a>.</p>
</div>
<div class="paragraph">
<p>The simplest case of using this might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span><span class="p">)</span>
<span class="c1">// checks the validity of a timestamp - this one returns {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="k">let</span> <span class="nv">cancellableSink</span> <span class="o">=</span> <span class="n">remoteDataPublisher</span><span class="o">.</span><span class="n">sink</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span> <i class="conum" data-value="5"></i><b>(5)</b>
                    <span class="k">break</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span> <i class="conum" data-value="6"></i><b>(6)</b>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"received error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Commonly you&#8217;ll have a struct defined that supports at least <a href="https://developer.apple.com/documentation/swift/decodable">Decodable</a> (if not the full <a href="https://developer.apple.com/documentation/swift/codable">Codable protocol</a>). This struct can be defined to only pull the pieces you&#8217;re interested in from the JSON provided over the network.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>dataTaskPublisher is instantiated from URLSession. You can configure your own options on URLSession, or use the general shared session as you require.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The data that is returns down the pipeline is a tuple: <code>(data: Data, response: URLResponse)</code>. The <a href="#reference-map">map</a> operator is used to get the data and drop the URL response, returning just Data down the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#reference-decode">decode</a> is used to load the data and attempt to transform it into the struct defined. Decode can throw an error itself if the decode fails. If it succeeds, the object passed down the pipeline will be the struct from the JSON data.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the decoding happened without errors, the finished completion will be triggered, and the value will also be passed to the receiveValue closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the a failure happened (either with the original network request or the decoding), the error will be passed into with the <code>.failure</code> completion.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only if the data succeeded with request and decoding will this closure get invoked, and the data format received with be an instance of the struct <code>PostmanEchoTimeStampCheckResponse</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="patterns-dataTaskPublisher-tryMap">Pattern 2.2: Stricter request processing with dataTaskPublisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When URLSession makes a connection, it only reports an error if the remote server doesn&#8217;t respond. You may want to consider a number of responses, based on status code, to be errors. To accomplish this, you can use tryMap to inspect the http response and throw an error in the pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-tryMap">tryMap</a></p>
</li>
<li>
<p><a href="#reference-decode">decode</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
<li>
<p><a href="#reference-subscribe">subscribe</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>To have more control over what is considered a failure in the URL response, use a <code>tryMap</code> operator on the tuple response from dataTaskPublisher.
Since dataTaskPublisher returns both the response data and the URLResponse into the pipeline, you can immediately inspect the response and throw an error of your own if desired.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An example of that might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span><span class="p">)</span>
<span class="c1">// checks the validity of a timestamp - this one returns {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>
<span class="kd">enum</span> <span class="nv">testFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">invalidServerResponse</span>
<span class="p">}</span>


<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span> <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
                        <span class="k">throw</span> <span class="n">testFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span> <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">data</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>

<span class="k">let</span> <span class="nv">cancellableSink</span> <span class="o">=</span> <span class="n">remoteDataPublisher</span><span class="o">.</span><span class="n">sink</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"received error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the <a href="#patterns-dataTaskPublisher-decode">previous pattern</a> used a <a href="#reference-map">map</a> operator, this uses tryMap, which allows us to identify and throw errors in the pipeline based on what was returned.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#reference-tryMap">tryMap</a> still gets the tuple of <code>(data: Data, response: URLResponse)</code>, and is defined here as returning just the type of Data down the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within the closure for tryMap, we can cast the response to HTTPURLResponse and dig deeper into it, including looking at the specific status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In this case, we want to consider <strong>anything</strong> other than a 200 response code as a failure. HTTPURLResponse.status_code is an Int type, so you could also have logic such as <code>httpResponse.statusCode &gt; 300</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the predicates aren&#8217;t met, then we can throw an instance of an error of our choosing, <code>invalidServerResponse</code> in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If no error has occured, then we simply pass down Data for further processing.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an error is triggered on the pipeline, a <code>.failure</code> completion is sent with the error encapsulated within it, regardless of where it happened in the pipeline.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-general-error-handling">Error Handling</h3>
<div class="paragraph">
<p>The examples above expected that the subscriber would handle the error conditions, if they occured.
However, you are not always able to control the subscriber - as might be the case if you&#8217;re using SwiftUI view properties as the subscriber, and you&#8217;re providing the publisher.
In these cases, you need to build your pipeline so that the output types match the subscriber types.</p>
</div>
<div class="paragraph">
<p>For example, if you are working with SwiftUI and the you want to use <code>.assign</code> to set the <code>isEnabled</code> property on a button, the subscriber will have a few requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the subcriber should match the type output of <code>&lt;Bool&gt;</code>, <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>the subscriber should be called on the main thread</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With a publisher that can throw an error (such as <code>dataTaskPublisher</code>), you need to construct a pipeline to convert the output type, but also handle the error within the pipeline to match a failure type of <code>&lt;Never&gt;</code>.</p>
</div>
<div class="paragraph">
<p>How you handle the errors within a pipeline is very dependent on how the pipeline is working.
If the pipeline is set up to return a single result and terminate, continue to <a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a>.
If the pipeline is set up to continually update, the error handling needs to be a little more complex.
Jump ahead to <a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a>.</p>
</div>
<div class="sect3">
<h4 id="patterns-assertNoFailure">Pattern 3.1: verifying a failure hasn&#8217;t happened using assertNoFailure</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Verify no error has occured within a pipeline</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-assertNoFailure">assertNoFailure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Useful in testing invariants in pipelines, the assertNoFailure operator also converts the failure type to <code>&lt;Never&gt;</code>.
The operator will cause the application to terminate (and tests to crash to a debugger) if the assertion is triggered.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is useful for verifying the invariant of having dealt with an error.
If you are sure you handled the errors and need to map a pipeline which technically can generate a failure type of <code>&lt;Error&gt;</code> to a subscriber that requires a failure type of <code>&lt;Never&gt;</code>.</p>
</div>
<div class="paragraph">
<p>It is far more likely that you want to handle the error with and not have the application terminate.
Look forward to <a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a> and <a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a> for patterns of how to provide logic to handle errors in a pipeline.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you need to handle a failure within a pipeline, for example before using the <code>assign</code> operator or another operator that requires the failure type to be <code>&lt;Never&gt;</code>, you can use <code>catch</code> to provide the appropriate logic.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
<li>
<p><a href="#reference-just">Just</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p><a href="#patterns-constrained-network">Pattern 4: Requesting data from an alternate URL when the network is constrained</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p><code>catch</code> handles errors by replacing the upstream publisher with another publisher that you provide as a return in a closure.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware that this effectively terminates the earlier portion of the pipeline.
If you&#8217;re using a one-shot publisher (one that doesn&#8217;t create more than a single event), then this is fine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, <code>dataTaskPublisher</code> is a one-shot publisher and you might use catch with it to ensure that you get a response, returning a placeholder in the event of an error.
Extending our previous example to provide a default response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">IPInfo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="c1">// matching the data structure returned from ip.jsontest.com</span>
    <span class="k">var</span> <span class="nv">ip</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://ip.jsontest.com"</span><span class="p">)</span>
<span class="c1">// NOTE(heckj): you'll need to enable insecure downloads in your Info.plist for this example</span>
<span class="c1">// since the URL scheme is 'http'</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">inputTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">inputTuple</span><span class="o">.</span><span class="n">data</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">IPInfo</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Just</span><span class="p">(</span><span class="kt">IPInfo</span><span class="p">(</span><span class="nv">ip</span><span class="p">:</span> <span class="s">"8.8.8.8"</span><span class="p">))</span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Often, a catch operator will be placed after several operators that could fail, in order to provide a fallback or placeholder in the event that any of the possible previous operations failed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When using catch, you get the error type in and can inspect it to chosoe how you provide a response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Just publisher is frequently used to either start another one-shot pipeline or to directly provide a placeholder response in the event of failure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A possible problem with this technique is that the if the original publisher generates more values to which you wish to react, the original pipeline has been ended.
If you are creating a pipeline that reacts to a <code>@Published</code> property, then after any failed value that activates the catch operator, the pipeline will cease to react further.
See <a href="#reference-catch">catch</a> for more illustration and examples of how this works.</p>
</div>
<div class="paragraph">
<p>If you want to continue to respond to errors and handle them, see <a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a> for an example of how to do that using <code>flatMap</code></p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>retry</code> operator can be included in a pipeline to retry a subscription when a <code>.failure</code> completion occurs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
<li>
<p><a href="#reference-retry">retry</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>When you specify this operator in a pipeline and it receives a subscription, it first tries to request a subscription from it&#8217;s upstream publisher.
If the response to that subscription fails, then it will retry the subscription to the same publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The retry operator can be specified with a number of retries to attempt.
If no number of retries is specified, it will attempt to retry indefinitely until it receives a .finished completion from it&#8217;s subscriber.
If the number of retries is specified and all requests fail, then the <code>.failure</code> completion is passed down to the subscriber of this operator.</p>
</div>
<div class="paragraph">
<p>In practice, this is mostly commonly desired when attempting to request network resources with an unstable connection.
If you use a retry operator, you should add a specific number of retries so that the subscription doesn&#8217;t effectively get into an infinite loop.</p>
</div>
<div class="paragraph">
<p>An example of the above example using retry in combination with a delay:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="n">urlSession</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">mockURL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="kt">SchedulerTimeType</span><span class="o">.</span><span class="kt">Stride</span><span class="p">(</span><span class="nv">integerLiteral</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">1</span><span class="o">..&lt;</span><span class="mi">5</span><span class="p">)),</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
            <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">testFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the delay operator will delay further processing on the pipeline, in this case for a random selection of 1 to 5 seconds. By adding delay here in the pipeline, it will always occur, even if the original request is successful.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>retry is specified as trying 3 times. If you specify retry without any options, it will retry infinitely, and may cause your pipeline to never resolve any values or completions.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>tryMap is being used to investigate errors after the retry so that retry will only re-attempt the request when the site didn&#8217;t respond.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the <code>retry()</code> operator with <code>dataTaskPublisher</code>, verify that the URL you are requesting isn&#8217;t going to have negative side effects if requested repeatedly or with a retry.
Ideally such requests are be expected to be idempotent.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>flatMap</code> operator can be used with <code>catch</code> to continue to handle errors on new published values.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-flatmap">[reference-flatmap]</a></p>
</li>
<li>
<p><a href="#reference-just">Just</a></p>
</li>
<li>
<p><a href="#reference-once">Publishers.Once</a></p>
</li>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>The <code>flatMap</code> operator is the operator to use in handling errors on a continual flow of events.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You provide a closure to flatMap that can read in the value that was provided, and creates a one-shot closure that does the possibly failing work.
An example of this is requesting data from a network and then decoding the returned data.
You can include a <a href="#reference-catch">catch</a> operator to capture any errors and provide any appropriate value.</p>
</div>
<div class="paragraph">
<p>This is a perfect mechanism for when you want to maintain updates up an upstream publisher, as it creates one-shot publisher or short pipelines that send a single value and then complete for every incoming value.
The completion from the created one-shot publishers terminates in the flatMap and isn&#8217;t passed to downstream subscribers.</p>
</div>
<div class="paragraph">
<p>An example of this with a dataTaskPublisher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">testURL</span><span class="o">!</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
                <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">testFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="o">.</span><span class="k">catch</span> <span class="p">{</span><span class="n">_</span> <span class="k">in</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">(</span><span class="nv">valid</span><span class="p">:</span> <span class="kc">false</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">myBackgroundQueue</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just starts this publisher as an example by passing in a URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>flatMap takes the URL as input and the closure goes on to create a one-shot publisher chain.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>dataTaskPublisher uses the input url</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which flows to tryMap to parse for additional errors</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and finally decode to attempt to refine the returned data into a local type</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>if any of these have failed, catch will convert the error into a placeholder sample, in this case an object with a preset <code>valid = false</code> property.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="patterns-constrained-network">Pattern 4: Requesting data from an alternate URL when the network is constrained</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From Apple&#8217;s WWDC 19 presentation <a href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a>, a sample pattern was provided using <code>tryCatch</code> and <code>tryMap</code> operators to react to the specific error of having the network be constrained.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-tryCatch">tryCatch</a></p>
</li>
<li>
<p><a href="#reference-tryMap">tryMap</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This sample is originally from the WWDC session.
The API and example is evolving with the beta releases of Combine since that presentation.
<code>tryCatch</code> was missing in the beta2 release, and has returned in beta3.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="c1">// Generalized Publisher for Adaptive URL Loading</span>
<span class="kd">func</span> <span class="nf">adaptiveLoader</span><span class="p">(</span><span class="nv">regularURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">lowDataURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">regularURL</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">request</span><span class="o">.</span><span class="n">allowsConstrainedNetworkAccess</span> <span class="o">=</span> <span class="kc">false</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="n">tryCatch</span> <span class="p">{</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="kt">URLSession</span><span class="o">.</span><span class="kt">DataTaskPublisher</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">guard</span> <span class="n">error</span><span class="o">.</span><span class="n">networkUnavailableReason</span> <span class="o">==</span> <span class="o">.</span><span class="n">constrained</span> <span class="k">else</span> <span class="p">{</span>
               <span class="k">throw</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">lowDataURL</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPUrlResponse</span><span class="p">,</span> <i class="conum" data-value="6"></i><b>(6)</b>
                   <span class="n">httpResponse</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                       <span class="k">throw</span> <span class="kt">MyNetworkingError</span><span class="o">.</span><span class="n">invalidServerResponse</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">data</span>
<span class="p">}</span>
<span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span> <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example, from Apple&#8217;s WWDC, provides a function that takes two URLs - a primary and a fallback.
It returns a publisher that will request data and fall back requesting a secondary URL when the network is constrained.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The request starts with an attempt requesting data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setting <code>request.allowsConstrainedNetworkAccess</code> will cause the dataTaskPublisher to error if the network is constrained.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Invoke the dataTaskPublisher to make the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>tryCatch is used to capture the immediate error condition and check for a specific error (the constrained network).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If it finds an error, it creates a new one-shot publisher with the fall-back URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The resulting publisher can still fail, and tryMap can map this a failure by throwing an error on HTTP response codes that map to error conditions</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>eraseToAnyPublisher will do type erasure on the chain of operators so the resulting signature of the adaptiveLoader function is of type <code>AnyPublisher&lt;Data, Error&gt;</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the sample, if the error returned from the original request wasn&#8217;t an issue of the network being constrained, it passes on the .failure completion down the pipeline.
If the error is that the network is constrained, then the tryCatch operator creates a new request to an alternate URL.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-update-interface-network-request">Pattern 5: Update the status of your interface from a network request</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Querying a web based API and returning the data to be displayed in your UI</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Below is a contrived example where you want to make a network to check for the username availability that you are watching with <code>@Published</code>.
As the property <code>username</code> is updated, you want to check to see if the updated username is available.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This contrived example expects that you have a web service that you can query, which will return a structured response in JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

<span class="kd">struct</span> <span class="kt">UsernameResponse</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span>
    <span class="nv">available</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">validatedUsername</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="err">$</span><span class="n">username</span>
        <span class="o">.</span><span class="nf">debounce</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span>
        <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">username</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">constructedURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://yourhost.com/?user=</span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">constructedURL</span><span class="o">!</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">inputTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
                    <span class="k">return</span> <span class="n">inputTuple</span><span class="o">.</span><span class="n">data</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">UsernameResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">UsernameResponse</span> <span class="k">in</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">available</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
                    <span class="c1">// if the service is down, or the JSON malformed, return a false response</span>
                    <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Just</span><span class="p">(</span><span class="kt">False</span><span class="p">))</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, for every update into .flatMap() we are creating a request to check and parse for the availability from the service.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-future">Pattern 6: Wrapping an asynchronous call with a Future</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Using Future to turn an an asynchronous call into publisher</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>let myPublisher = Publishers.Future { promise in
    asyncFunctionWithACompletion(inputValue) { outputValue in
        promise(.success(outputValue ? inputValue : nil))
    }
}
.eraseToAnyPublisher()</pre>
</div>
</div>
<div class="paragraph">
<p>This setup can be used to inline just about anything into a Combine pipeline.</p>
</div>
<div class="paragraph">
<p>possible example:
- take periodic frame updates from the camera and run them into the Vision framework to ask if there&#8217;s a bar code, and if so, retrieve it and display its info</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-sequencing-async">Pattern 7: Coordinating a sequence of asynchronous operations</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>There are a variety of ways to chain together asynchronous operations.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Combine adds to this variety, and is effective when you want to use the data from one operation as the input to the next.
If you are familiar with using Promises in another language, such as Javascript, this pattern is roughly the equivalent of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises#Chaining">Promise chaining</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The benefit to using Combine is that the sequencing can be relatively easy to parse visually.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-published">Pattern 8: Responding to updates in properties with @Published</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>@Published with properties and using read-only updates of those properties as publishing sources</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>@Published var username: String = ""

var validatedUsername: AnyPublisher&lt;String?, Never&gt; {
    return $username
        .debounce(for: 0.5, scheduler: RunLoop.main)
           //  &lt;String?&gt;|&lt;Never&gt;
        .removeDuplicates()
           //  &lt;String?&gt;|&lt;Never&gt;
        .flatMap { username in
            return Future { promise in
                self.usernameAvailable(username) { available in
                   promise(.success(available ? username : nil))
                }
          //    &lt;Result&lt;Output, Failure&gt;&gt;
            }
        }
          // &lt;String?&gt;|&lt;Never&gt;
        .eraseToAnyPublisher()
}</pre>
</div>
</div>
<div class="paragraph">
<p>validation - listening for changes to validate them together</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">password</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">passwordAgain</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">var</span> <span class="nv">validatedPassword</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">CombineLatest</span><span class="p">(</span><span class="err">$</span><span class="n">password</span><span class="p">,</span> <span class="err">$</span><span class="n">passwordAgain</span><span class="p">)</span> <span class="p">{</span> <span class="n">password</span><span class="p">,</span> <span class="n">passwordAgain</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">password</span> <span class="o">==</span> <span class="n">passwordAgain</span><span class="p">,</span> <span class="n">password</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">8</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">password</span>
    <span class="p">}</span>
      <span class="c1">//  &lt;String?&gt;|&lt;Never&gt;</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">==</span> <span class="n">password1</span> <span class="p">?</span> <span class="nv">nil</span> <span class="p">:</span> <span class="nv">$0</span> <span class="p">}</span>
      <span class="c1">//  &lt;String?&gt;|&lt;Never&gt;</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
      <span class="c1">//  &lt;String?&gt;|&lt;Never&gt;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>more complex validation - bringing together substreams</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">var</span> <span class="nv">validatedCredentials</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">CombineLatest</span><span class="p">(</span><span class="n">validatedUsername</span><span class="p">,</span> <span class="n">validatedPassword</span><span class="p">)</span> <span class="p">{</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">uname</span> <span class="o">=</span> <span class="n">username</span><span class="p">,</span> <span class="k">let</span> <span class="nv">pwd</span> <span class="o">=</span> <span class="n">password</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="nf">return</span> <span class="p">(</span><span class="n">uname</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">@IBOutlet</span> <span class="k">var</span> <span class="nv">signupButton</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>

<span class="k">var</span> <span class="nv">signupButtonStream</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    <span class="k">self</span><span class="o">.</span><span class="n">signupButtonStream</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">validatedCredentials</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">signupButton</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-notificationcenter">Pattern 9: Responding to updates from NotificationCenter</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The big "master bus" of events across a variety of Apple platforms, its where you can listen for updates and changes from controls and events across a variety of frameworks.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p><a href="https://www.caseyliss.com/2019/6/18/quick-notes-on-yesterdays-post">Casey Liss talks about about this (not entirely happily)</a> based on the apple documentation <a href="https://developer.apple.com/documentation/combine/receiving_and_handling_events_with_combine">Receiving and Handling Events with Combine</a>.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-bindableobject">Pattern 10: Using BindableObject with SwiftUI models as a publisher source</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SwiftUI includes @Binding and the BindableObject protocol, which provides a publishing source to alerts to model objects changing.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="patterns-testing-pipeline">Pattern N.1: Testing pipelines</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing what&#8217;s happening in a pipeline</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>use a Subject &#8594; pipeline &#8594; sink()</p>
</li>
<li>
<p>set up a sink to collect value</p>
</li>
<li>
<p>drive values through the pipeline with Subject.send()</p>
</li>
<li>
<p>assert results after the sink has processed them</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="patterns-testing-publisher">Pattern N.2: Testing a publisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a publisher (and any pipeline attached)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>set up an expectation (<code>XCTestExpectation</code>)</p>
</li>
<li>
<p>create your publisher &amp; relevant pipeline if so desired</p>
</li>
<li>
<p>create a sink to capture the results that works on both completions and values</p>
<div class="ulist">
<ul>
<li>
<p>this can be separate, or just chained to the pipeline, depending on what makes most sense to you</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>wait</code> on the expectation to let the test "do it&#8217;s thing" in the background</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-testing-subscriber">Pattern N.3: Testing a subscriber</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a subscriber (how it reacts):</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>set up your subscriber and any pipeline leading to it</p>
</li>
<li>
<p>use a Subject to "inject" values</p>
</li>
<li>
<p>test the results after the value is sent</p>
</li>
<li>
<p>if the updates include some async/background work before data is available, use an expectation</p>
<div class="ulist">
<ul>
<li>
<p>add a callback to the async pieces where you can trigger the expectation, and do your asserts just prior to fulfilling the expectation</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>&amp; of course you can always test using UITesting - spinning up your whole app, initializing state, and then driving and verifying the results.</p>
</div>
<div class="paragraph">
<p><em>(Uncertain)</em> Mocking or faking a publisher (such as dataTaskPublisher) to validate things like using <code>retry()</code> operator
* might be able to use a <code>Publishers.Future()</code>, expose as an AnyPublisher() (do the same with dataTaskPublisher) to make the the same - and in your setup, inject in the one you want to use.
** Instrument the Future() closure to record what gets called, and maybe set it up to return an explicit set of responses.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-debugging">Pattern N+1: Debugging pipelines</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a subscriber (how it reacts):</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to reference pages&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&lt;&lt; link to other patterns&gt;&gt;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use print() and/or print("prefixValue") to get console output of what&#8217;s happening in the pipeline lifecycle</p>
<div class="ulist">
<ul>
<li>
<p>create a .sink() to capture results, and drive it with a PassthroughSubject for specific control</p>
</li>
</ul>
</div>
</li>
<li>
<p>add a handleEvents() operator</p>
<div class="ulist">
<ul>
<li>
<p>create closures to do additional poking at values or digging into more structured pieces than get exposed with a print()</p>
</li>
<li>
<p>allows you to ignore some sections you don&#8217;t care about</p>
</li>
<li>
<p>closures on <code>receiveSubscription</code>, <code>receiveRequest</code>, <code>receiveCancel</code>, <code>receiveOutput</code>, and <code>receiveCompletion</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>breakPoint</p>
<div class="ulist">
<ul>
<li>
<p>if you want to break into a debugger, add in a closure that returns true and you can inspect to your heart&#8217;s content</p>
<div class="ulist">
<ul>
<li>
<p>closure&#8217;s on <code>receiveSubscription</code>, <code>receiveOutput</code>, and <code>receiveCompletion</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>might also be interesting to use breakpointOnError() which triggers only when a failure completion</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>reference preamble goes here&#8230;&#8203;</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is intended to extend Apple&#8217;s documentation, not replace it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The documentation associated with beta2 is better than beta1, but still fairly anemic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>things to potentially include for each segment</p>
</div>
<div class="ulist">
<ul>
<li>
<p>narrative description of what the function does</p>
<div class="ulist">
<ul>
<li>
<p>notes on why you might want to use it, or where you may see it</p>
</li>
<li>
<p>xref back to patterns document where functions are being used</p>
</li>
</ul>
</div>
</li>
<li>
<p>marble/railroad diagram explaining what the transformation/operator does</p>
</li>
<li>
<p>sample code showing it being used and/or tested</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="reference-publishers">Publishers</h3>
<div class="sect3">
<h4 id="reference-just">Just</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Just</code> provides a single result and then terminates, providing a publisher with a failure type of <code>&lt;Never&gt;</code></p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/just"><code>Just</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Often used within a closure to <a href="#reference-flatMap">flatMap</a> in error handling, it can see a one-shot pipeline for use in error handling of continuous values.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-future">Future</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A future is initialized with a closure that eventually resolves to a value.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/future">Future</a>.</p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>you provide a closure that converts a callback/function of your own choosing into a <a href="https://developer.apple.com/documentation/combine/future/promise">Promise</a>.</p>
</li>
<li>
<p>in creating a Future publisher, you need to handle the logic of when you generate the relevant <code>Result&lt;Output, Error&gt;</code> with the asynchronous calls.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-published">Published</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A property wrapper that adds a Combine publisher to any property</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/published">Published</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Output type is inferred from the property being wrapped.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>publisher &#8594; <code>&lt;SomeType&gt;</code>, <code>&lt;Never&gt;</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>extracts a property from an object and returns it</p>
<div class="ulist">
<ul>
<li>
<p>ex: <code>.publisher(for: \.name)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reference-empty">Publishers.Empty</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>empty</code> never publishes any values, and optionally finishes immediately.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/empty"><code>Publishers.Empty</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a> shows an example of using <code>catch</code> to handle errors with a one-shot publisher.</p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a> shows an example of using <code>catch</code> with <code>flatMap</code> to handle errors with a continual publisher.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Empty &#8594; <code>&lt;SomeType&gt;</code>, <code>&lt;Error&gt;</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Empty(completeImmediately: false)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-fail">Publishers.Fail</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>fail</code> immediately terminates publishing with the specified failure.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/fail"><code>Publishers.Fail</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>n/a</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-once">Publishers.Once</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Generates an output to each subscriber exactly once then finishes or fails immediately.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/once"><code>Once</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>TBD</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Used similiarly to <a href="#reference-just">Just</a>, it provides a value and then completes.
It is often used with flatMap when you want to flow have flatMap return a publisher that returns a publisher with an error type.
Where <a href="#reference-just">Just</a> returns a failure type of <code>&lt;Never&gt;</code>, <code>once</code> allows for a failure type of <code>&lt;Error&gt;</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-optional">Publishers.Optional</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>generates a value exactly once for each subscriber, if the optional has a value</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/optional"><code>Publishers.Optional</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>n/a</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-sequence">Publishers.Sequence</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes a provided sequence of elements.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence"><code>Publishers.Sequence</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>n/a</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-deferred">Publishers.Deferred</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publisher waits for a subscriber before running the provided closure to create values for the subscriber.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/deferred"><code>Publishers.Deferred</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<p>n/a</p>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>n/a</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-swiftUI">SwiftUI</h4>
<div class="ulist">
<ul>
<li>
<p>@ObjectBinding (swiftUI)</p>
</li>
<li>
<p>BindableObject</p>
</li>
<li>
<p>often linked with method <code>didChange</code> to publish changes to model objects</p>
<div class="ulist">
<ul>
<li>
<p><code>@ObjectBinding var model: MyModel</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-foundation">Foundation</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/notificationcenter"><code>NotificationCenter</code></a> <a href="https://developer.apple.com/documentation/foundation/notificationcenter/3329353-publisher"><code>.publisher</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/timer"><code>Timer</code></a> <a href="https://developer.apple.com/documentation/foundation/notificationcenter/3329353-publisher"><code>.publish</code></a> and <a href="https://developer.apple.com/documentation/foundation/timer/timerpublisher"><code>Timer.TimerPublisher</code></a></p>
<div class="ulist">
<ul>
<li>
<p>* <a href="https://developer.apple.com/documentation/foundation/timer/timerpublisher">TimerPublisher</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reference-dataTaskPublisher">URLSession.dataTaskPublisher</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation&#8217;s <a href="https://developer.apple.com/documentation/foundation/urlsession"><code>URLSession</code></a> has a publisher specifically for requesting data from URLs: dataTaskPublisher</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/foundation/urlsession/datataskpublisher"><code>URLSession.DataTaskPublisher</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p><a href="#patterns-constrained-network">Pattern 4: Requesting data from an alternate URL when the network is constrained</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>dataTaskPublisher</code>, on URLSession, has two variants for creating a publisher.
The first takes an instance of <a href="https://developer.apple.com/documentation/foundation/url">URL</a>, the second <a href="https://developer.apple.com/documentation/foundation/urlrequest">URLRequest</a>.
The data returned from the publisher is a tuple of <code>(data: Data, response: <a href="https://developer.apple.com/documentation/foundation/urlResponse">URLResponse</a>)</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">regularURL</span><span class="p">)</span>
<span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-realitykit">RealityKit</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit"><code>RealityKit</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene"><code>.Scene</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene/3254685-publisher"><code>.publisher()</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scene Publisher (from <a href="https://developer.apple.com/documentation/realitykit">RealityKit</a>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/scene/publisher">Scene.Publisher</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/sceneevents">SceneEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/animationevents">AnimationEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/audioevents">AudioEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/collisionevents">CollisionEvents</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="reference-operators">Operators</h3>
<div class="sect3">
<h4 id="reference-operators-mapping">Mapping elements</h4>
<div class="sect4">
<h5 id="reference-scan">scan</h5>
<div class="ulist">
<ul>
<li>
<p>scan</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryScan">tryScan</h5>
<div class="ulist">
<ul>
<li>
<p>tryScan</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-map">map</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>map is most commonly used to convert one data type into another along a pipeline.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/map" class="bare">https://developer.apple.com/documentation/combine/publishers/map</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>n/a</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p>unit tests illustrating using map with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The map operator doesn&#8217;t allow for any additional failures to be thrown, and doesn&#8217;t transform the failure type.
If you want to throw an error within your closure, then use the <a href="#reference-tryMap">tryMap</a> operator.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>map takes a single closure where you provide the logic for the map operation.</p>
</div>
<div class="paragraph">
<p>For example, the <a href="#reference-dataTaskPublisher">URLSession.dataTaskPublisher</a> provides a tuple of <code>(data: Data, response: URLResponse)`</code> as its output.
You can use map to pass along the data, for example to use with <a href="#reference-decode">decode</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>$0</code> indicates to grab the first parameter passed in, which is a tuple of <code>data</code> and <code>response</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases, the closure may not be able to infer what data type you are returning, so you may need to provide a definition to help the compiler.
For example, if you have an object getting passed down that has a boolean property "isValid" on it, and you just want the boolean for your pipeline, you might set that up like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="n">myStruct</span> <span class="p">{</span>
    <span class="nv">isValid</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="c1">//</span>
<span class="kt">Just</span><span class="p">(</span><span class="nf">myStruct</span><span class="p">())</span>
<span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">inValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="n">inValue</span><span class="o">.</span><span class="n">isValid</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inValue is named as the parameter coming in, and the return type is being explicitly specified to <code>Bool</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A single line is an implicit return, in this case it&#8217;s pulling the <code>isValid</code> property off the struct and passing it down the pipeline.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryMap">tryMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>tryMap is effectively the similiar to <a href="#reference-map">map</a>, except that it also allows you to provide a closure that throws additional errors if your conversion logic is unsuccessful.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trymap" class="bare">https://developer.apple.com/documentation/combine/publishers/trymap</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-tryMap">Pattern 2.2: Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p>unit tests illustrating using tryMap with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>tryMap is useful when you have more complex business logic around your map and you want to indicate that the data passed in is an error, possibly handling that error later in the pipeline.
If you are looking at tryMap to decode JSON, you may want to consider using the <a href="#reference-decode">decode</a> operator instead, which is set up for that common task.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="nv">myFailure</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">notBigEnough</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">inValue</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="k">throw</span> <span class="n">myFailure</span><span class="o">.</span><span class="n">notBigEnough</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">inValue</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify whatever logic is relevant to your use case within tryMap</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>and throw an error, although throwing an Error isn&#8217;t required.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the error condition doesn&#8217;t occur, you do need to pass down data for any further subscribers.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-flatMap">flatMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Used with error recovery or async operations that might fail (ex: Future), flatMap will replace any incoming values with another publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/flatmap"><code>flatMap</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Most typically used in error handling scenarios, flatMap takes a closure that allows you to read the incoming data value, and provide a publisher that returns a value to the pipeline.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In error handling, this is most frequently used to take the incoming value and create a one-shot pipeline that does some potentially failing operation, and then handling the error condition with a <a href="#reference-catch">catch</a> operator.</p>
</div>
<div class="paragraph">
<p>A diagram version of this pipeline construct might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>     one-shot-publisher(value) -&gt; catch ( fallback )      // &lt;- one-shot pipeline
                          ^                        \
                          |                         \
publisher -&gt; flatMap -&gt; ( +                           +  ) -&gt; subscriber</code></pre>
</div>
</div>
<div class="paragraph">
<p>In swift, this looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">YourType</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">YourType</span><span class="o">.</span><span class="n">placeholder</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-setFailureType">setFailureType</h5>
<div class="ulist">
<ul>
<li>
<p>setFailureType</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-filtering">Filtering elements</h4>
<div class="sect4">
<h5 id="reference-compactMap">compactMap</h5>
<div class="ulist">
<ul>
<li>
<p>compactMap</p>
<div class="ulist">
<ul>
<li>
<p>republishes all non-nil results of calling a closure with each received element.</p>
</li>
<li>
<p>there&#8217;s a variant <code>tryCompactMap</code> for use with a provided error-throwing closure.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryCompactMap">tryCompactMap</h5>
<div class="ulist">
<ul>
<li>
<p>tryCompactMap</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-filter">filter</h5>
<div class="ulist">
<ul>
<li>
<p>filter</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>takes a closure where you can specify how/what gets filtered</p>
</li>
<li>
<p>there&#8217;s a variant `tryFilter`for use with a provided error-throwing closure.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryFilter">tryFilter</h5>
<div class="ulist">
<ul>
<li>
<p>tryFilter</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-removeDuplicates">removeDuplicates</h5>
<div class="ulist">
<ul>
<li>
<p>removeDuplicates</p>
<div class="ulist">
<ul>
<li>
<p><code>.removeDuplicates()</code></p>
</li>
<li>
<p>remembers what was previously sent in the stream, and only passes forward new values</p>
</li>
<li>
<p>there&#8217;s a variant <code>tryRemoveDuplicates</code> for use with a provided error-throwing closure.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryRemoveDuplicates">tryRemoveDuplicates</h5>
<div class="ulist">
<ul>
<li>
<p>tryRemoveDuplicates</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-replaceEmpty">replaceEmpty</h5>
<div class="ulist">
<ul>
<li>
<p>replaceEmpty</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-replaceError">replaceError</h5>
<div class="ulist">
<ul>
<li>
<p>replaceError</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-replaceNil">replaceNil</h5>
<div class="ulist">
<ul>
<li>
<p>replaceNil</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>Replaces nil elements in the stream with the proviced element.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-reducing">Reducing elements</h4>
<div class="sect4">
<h5 id="reference-collect">collect</h5>
<div class="ulist">
<ul>
<li>
<p>collect</p>
<div class="ulist">
<ul>
<li>
<p>multiple variants</p>
<div class="ulist">
<ul>
<li>
<p>buffers items</p>
</li>
<li>
<p><code>collect()</code> Collects all received elements, and emits a single array of the collection when the upstream publisher finishes.</p>
</li>
<li>
<p><code>collect(Int)</code> collects N elements and emits as an array</p>
</li>
<li>
<p><code>collect(.byTime)</code> or <code>collect(.byTimeOrCount)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-collectByCount">collectByCount</h5>
<div class="ulist">
<ul>
<li>
<p>collectByCount</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-collectByTime">collectByTime</h5>
<div class="ulist">
<ul>
<li>
<p>collectByTime</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-ignoreOutput">ignoreOutput</h5>
<div class="ulist">
<ul>
<li>
<p>ignoreOutput</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-reduce">reduce</h5>
<div class="ulist">
<ul>
<li>
<p>reduce</p>
<div class="ulist">
<ul>
<li>
<p>A publisher that applies a closure to all received elements and produces an accumulated value when the upstream publisher finishes.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>there&#8217;s a varient <code>tryReduce</code> for use with a provided error-throwing closure.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryReduce">tryReduce</h5>
<div class="ulist">
<ul>
<li>
<p>tryReduce</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-mathematical">Mathematic opertions on elements</h4>
<div class="sect4">
<h5 id="reference-max">max</h5>
<div class="ulist">
<ul>
<li>
<p>max</p>
<div class="ulist">
<ul>
<li>
<p>Available when Output conforms to Comparable.</p>
</li>
<li>
<p>Publishes the maximum value received from the upstream publisher, after it finishes.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-min">min</h5>
<div class="ulist">
<ul>
<li>
<p>Publishes the minimum value received from the upstream publisher, after it finishes.</p>
</li>
<li>
<p>Available when Output conforms to Comparable.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-comparison">comparison</h5>
<div class="ulist">
<ul>
<li>
<p>comparison</p>
<div class="ulist">
<ul>
<li>
<p>republishes items from another publisher only if each new item is in increasing order from the previously-published item.</p>
</li>
<li>
<p>there&#8217;s a variant <code>tryComparson</code> which fails if the ordering logic throws an error</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryComparison">tryComparison</h5>
<div class="ulist">
<ul>
<li>
<p>tryComparison</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-count">count</h5>
<div class="ulist">
<ul>
<li>
<p>count</p>
<div class="ulist">
<ul>
<li>
<p>publishes the number of items received from the upstream publisher</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-criteria">Applying matching criteria to elements</h4>
<div class="sect4">
<h5 id="reference-allSatisfy">allSatisfy</h5>
<div class="ulist">
<ul>
<li>
<p>allSatisfy</p>
<div class="ulist">
<ul>
<li>
<p>Publishes a single Boolean value that indicates whether all received elements pass a given predicate.</p>
</li>
<li>
<p>there&#8217;s a variant <code>tryAllSatisfy</code> when the predicate can throw errors</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryAllSatisfy">tryAllSatisfy</h5>
<div class="ulist">
<ul>
<li>
<p>tryAllSatisfy</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-contains">contains</h5>
<div class="ulist">
<ul>
<li>
<p>contains</p>
<div class="ulist">
<ul>
<li>
<p>emits a Boolean value when a specified element is received from its upstream publisher.</p>
</li>
<li>
<p>variant <code>containsWhere</code> when a provided predicate is satisfied</p>
</li>
<li>
<p>variant <code>tryContainsWhere</code> when a provided predicate is satisfied but could throw errors</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-containsWhere">containsWhere</h5>
<div class="ulist">
<ul>
<li>
<p>containsWhere</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryContainsWhere">tryContainsWhere</h5>
<div class="ulist">
<ul>
<li>
<p>tryContainsWhere</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-sequence">Applying sequence operations to elements</h4>
<div class="sect4">
<h5 id="reference-first">first</h5>
<div class="ulist">
<ul>
<li>
<p>first</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>publishes the first element to satisfy a provided predicate</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-firstWhere">firstWhere</h5>
<div class="ulist">
<ul>
<li>
<p>firstWhere</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryFirstWhere">tryFirstWhere</h5>
<div class="ulist">
<ul>
<li>
<p>tryFirstWhere</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-last">last</h5>
<div class="ulist">
<ul>
<li>
<p>last</p>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>publishes the last element to satisfy a provided predicate</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-lastWhere">lastWhere</h5>
<div class="ulist">
<ul>
<li>
<p>lastWhere</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryLastWhere">tryLastWhere</h5>
<div class="ulist">
<ul>
<li>
<p>tryLastWhere</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-dropUntilOutput">dropUntilOutput</h5>
<div class="ulist">
<ul>
<li>
<p>dropUntilOutput</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-dropWhile">dropWhile</h5>
<div class="ulist">
<ul>
<li>
<p>dropWhile</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryDropWhile">tryDropWhile</h5>
<div class="ulist">
<ul>
<li>
<p>tryDropWhile</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-concatenate">concatenate</h5>
<div class="ulist">
<ul>
<li>
<p>concatenate</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-drop">drop</h5>
<div class="ulist">
<ul>
<li>
<p>drop</p>
<div class="ulist">
<ul>
<li>
<p>multiple variants</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>Ignores elements from the upstream publisher until it receives an element from a second publisher.</p>
</li>
<li>
<p>or <code>drop(while: {})</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-prefixUntilOutput">prefixUntilOutput</h5>
<div class="ulist">
<ul>
<li>
<p>prefixUntilOutput</p>
<div class="ulist">
<ul>
<li>
<p>Republishes elements until another publisher emits an element.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-prefixWhile">prefixWhile</h5>
<div class="ulist">
<ul>
<li>
<p>prefixWhile</p>
<div class="ulist">
<ul>
<li>
<p>Republishes elements until another publisher emits an element.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryPrefixWhile">tryPrefixWhile</h5>
<div class="ulist">
<ul>
<li>
<p>tryPrefixWhile</p>
<div class="ulist">
<ul>
<li>
<p>Republishes elements until another publisher emits an element.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-output">output</h5>
<div class="ulist">
<ul>
<li>
<p>output</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-combinepublishers">Combining elements from multiple publishers</h4>
<div class="sect4">
<h5 id="reference-combineLatest">combineLatest</h5>
<div class="ulist">
<ul>
<li>
<p>combineLatest</p>
<div class="ulist">
<ul>
<li>
<p>brings inputs from 2 (or more) streams together</p>
</li>
<li>
<p>you provide a closure that gets the values and chooses what to publish</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryCombineLatest">tryCombineLatest</h5>
<div class="ulist">
<ul>
<li>
<p>tryCombineLatest</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-merge">merge</h5>
<div class="ulist">
<ul>
<li>
<p>merge</p>
<div class="ulist">
<ul>
<li>
<p>Combines elements from this publisher with those from another publisher of the same type, delivering an interleaved sequence of elements.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
<li>
<p>multiple variants that will merge between 2 and 8 different streams</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-zip">zip</h5>
<div class="ulist">
<ul>
<li>
<p>zip</p>
<div class="ulist">
<ul>
<li>
<p>Combine elements from another publisher and deliver pairs of elements as tuples.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-handlingErrors">Handling errors</h4>
<div class="paragraph">
<p>See <a href="#patterns-general-error-handling">Error Handling</a> for more detail on how you can design error handling.</p>
</div>
<div class="sect4">
<h5 id="reference-catch">catch</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The operator <code>catch</code> handles errors (completion messages of type <code>.failure</code>) from an upstream publisher by replacing the failed publisher with another publisher.
The operator also transforms the Failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> Documentation reference</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/catch"><code>Publishers.Catch</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a> shows an example of using <code>catch</code> to handle errors with a one-shot publisher.</p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Pattern 3.4: Using flatMap with catch to handle errors</a> shows an example of using <code>catch</code> with <code>flatMap</code> to handle errors with a continual publisher.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Once catch receives a <code>.failure</code> completion, it won&#8217;t send any further incoming values from the original upstream publisher.
You can also view catch as a switch that only toggles in one direction: to using a new publisher that you define, but only when the original publisher to which it is subscribed sends an error.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This can be illustrated with the following code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="nv">testFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">invalidServerResponse</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">simplePublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">simplePublisher</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
        <span class="c1">// must return a Publisher</span>
        <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="s">"replacement value"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">fini</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion:"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">fini</span><span class="p">))</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">stringValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">stringValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"oneValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"twoValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">Subscribers</span><span class="o">.</span><span class="kt">Completion</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">testFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span><span class="p">))</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"redValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"blueValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="o">.</span><span class="n">finished</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are using a <code>PassthroughSubject</code> so that we can control when and what gets sent from the publisher.
In the above code, we are sending two good values, then a failure, then attempting to send two more good values.
The values you would see printed from our <code>.sink()</code> closures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>.sink() received oneValue
.sink() received twoValue
.sink() received replacement value
.sink() received the completion: finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the failure was sent through the pipeline, catch intercepts it and returns "replacement value" as expected.
The replacement publisher it used (<code>Just</code>) sends a single value and then sends a completion.
If we want the pipeline to remain active, we need to change how we handle the errors.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryCatch">tryCatch</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A variant of the <a href="#reference-catch">catch</a> operator that also allows an <code>&lt;Error&gt;</code> failure type, and doesn&#8217;t convert the failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trycatch" class="bare">https://developer.apple.com/documentation/combine/publishers/trycatch</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-constrained-network">Pattern 4: Requesting data from an alternate URL when the network is constrained</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryCatch</code> is a variant of <a href="#reference-catch">catch</a> that has a failure type of <code>&lt;Error&gt;</code> rather than catch&#8217;s failure type of <code>&lt;Never&gt;</code>.
This allows it to be used where you want to immediately react to an error by creating another publisher that may also produce a failure type.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-assertNoFailure">assertNoFailure</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Raises a fatal error when its upstream publisher fails, and otherwise republishes all received input and converts failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/assertnofailure" class="bare">https://developer.apple.com/documentation/combine/publishers/assertnofailure</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assertNoFailure">Pattern 3.1: verifying a failure hasn&#8217;t happened using assertNoFailure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>If you need to verify that no error has occured (treating the error output as an invariant), this is the operator to use.
Like it&#8217;s namesakes, it will cause the program to terminate if the assert is violated.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Adding it into the pipeline requires no additional parameters, but you can include a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">assertNoFailure</span><span class="p">()</span>
<span class="c1">// OR</span>
<span class="o">.</span><span class="nf">assertNoFailure</span><span class="p">(</span><span class="s">"What could possibly go wrong?"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>I&#8217;m not entirely clear on where that string would appear if you did include it.</p>
</div>
<div class="paragraph">
<p>When trying out this code in unit tests, the tests invariably drop into a debugger at the assertion point when a .failure is processed through the pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to convert an failure tyoe output of <code>&lt;Error&gt;</code> to <code>&lt;Never&gt;</code>, you probably want to look at the <a href="#reference-catch">catch</a> operator.</p>
</div>
<div class="paragraph">
<p>Apple asserts this function should be primarily used for testing and verifying "internal sanity checks that are active during testing".</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-retry">retry</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The retry opeator is used to repeat requests to a previous publisher in the event of an error.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>failure type must be <code>&lt;Error&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/retry" class="bare">https://developer.apple.com/documentation/combine/publishers/retry</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p>unit tests illustrating using map with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When you specify this operator in a pipeline and it receives a subscription, it first tries to request a subscription from it&#8217;s upstream publisher.
If the response to that subscription fails, then it will retry the subscription to the same publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The retry operator accepts an optional (but recommended) single parameter that specifies a number of retries to attempt.
If no number of retries is specified, it will attempt to retry indefinitely until it receives a .finished completion from it&#8217;s subscriber.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using retry without any specific count can result in your pipeline never resolving any data or completions.
If you use retry without a count, you may also want to use the <a href="#reference-timeout">timeout</a> operator to force a completion from the pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the number of retries is specified and all requests fail, then the <code>.failure</code> completion is passed down to the subscriber of this operator.</p>
</div>
<div class="paragraph">
<p>In practice, this is mostly commonly desired when attempting to request network resources with an unstable connection.
If you use a retry operator, you should add a specific number of retries so that the subscription doesn&#8217;t effectively get into an infinite loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">IPInfo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="c1">// matching the data structure returned from ip.jsontest.com</span>
    <span class="k">var</span> <span class="nv">ip</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://ip.jsontest.com"</span><span class="p">)</span>
<span class="c1">// NOTE(heckj): you'll need to enable insecure downloads in your Info.plist for this example</span>
<span class="c1">// since the URL scheme is 'http'</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1">// if the URLSession returns a .failure completion, try at most 3 times to get a successful response</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">inputTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">inputTuple</span><span class="o">.</span><span class="n">data</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">IPInfo</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Just</span><span class="p">(</span><span class="kt">IPInfo</span><span class="p">(</span><span class="nv">ip</span><span class="p">:</span> <span class="s">"8.8.8.8"</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-mapError">mapError</h5>
<div class="ulist">
<ul>
<li>
<p>mapError</p>
<div class="ulist">
<ul>
<li>
<p>Converts any failure from the upstream publisher into a new error.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-adaptingTypes">Adapting publisher types</h4>
<div class="sect4">
<h5 id="reference-switchToLatest">switchToLatest</h5>
<div class="ulist">
<ul>
<li>
<p>switchToLatest?</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-timing">Controlling timing</h4>
<div class="sect4">
<h5 id="reference-debounce">debounce</h5>
<div class="ulist">
<ul>
<li>
<p>debounce</p>
<div class="ulist">
<ul>
<li>
<p><code>.debounce(for: 0.5, scheduler: RunLoop.main)</code></p>
</li>
<li>
<p>collapses multiple values within a specified time window into a single value</p>
</li>
<li>
<p>often used with <code>.removeDuplicates()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-delay">delay</h5>
<div class="ulist">
<ul>
<li>
<p>delay</p>
<div class="ulist">
<ul>
<li>
<p>Delays delivery of all output to the downstream receiver by a specified amount of time on a particular scheduler.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-measureInterval">measureInterval</h5>
<div class="ulist">
<ul>
<li>
<p>measureInterval</p>
<div class="ulist">
<ul>
<li>
<p>Measures and emits the time interval between events received from an upstream publisher.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-throttle">throttle</h5>
<div class="ulist">
<ul>
<li>
<p>throttle</p>
<div class="ulist">
<ul>
<li>
<p>Publishes either the most-recent or first element published by the upstream publisher in the specified time interval.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-timeout">timeout</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Terminates publishing if the upstream publisher exceeds the specified time interval without producing an element.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/timeout" class="bare">https://developer.apple.com/documentation/combine/publishers/timeout</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using retry and timeout with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Timeout will force a resolution to a pipeline after a given amount of time, but does not guarantee either data or errors, only a completion.
If a timeout does trigger and force a completion, it will not generate an failure completion with an error.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Timeout is specified with two parameters, a time period and a scheduler.</p>
</div>
<div class="paragraph">
<p>If you are using a specific background thread (for example, with the <a href="#reference-subscribe">subscribe</a> operator), then timeout should likely be using the same scheduler.</p>
</div>
<div class="paragraph">
<p>The time period specified will take a literal integer, but otherwise needs to conform to the protocol <a href="https://developer.apple.com/documentation/combine/schedulertimeintervalconvertible">SchedulerTimeIntervalConvertible</a>.
If you want to set a number from a Float or Int, you need to create the relevant structure, as Int or Float directly doesn&#8217;t conform.
For example, if you&#8217;re using a DispatchQueue, you could use <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue/schedulertimetype/stride">DispatchQueue.SchedulerTimeType.Stride</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="n">urlSession</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">mockURL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">// 5 retries, 2 seconds each ~ 10 seconds for this to fall through</span>
    <span class="o">.</span><span class="nf">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <span class="c1">// max time of 5 seconds before failing</span>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
            <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">testFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-coding">Encoding and decoding</h4>
<div class="sect4">
<h5 id="reference-encode">encode</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Encode converts the output from upstream Encodable object using a specified TopLevelEncoder. For example, use JSONEncoder or PropertyListEncoder..</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available when Output conforms to Encodable.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/encode" class="bare">https://developer.apple.com/documentation/combine/publishers/encode</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using encode and decode: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EncodeDecodeTests.swift"><code>UsingCombineTests/EncodeDecodeTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The encode operator takes a single parameters:</p>
<div class="ulist">
<ul>
<li>
<p><code>encoder</code> an instance of an object conforming to <a href="https://developer.apple.com/documentation/combine/toplevelencoder">TopLevelEncoder</a>, frequently an instance of <a href="https://developer.apple.com/documentation/foundation/jsonencoder">JSONEncoder</a>() or <a href="https://developer.apple.com/documentation/foundation/propertylistencoder">PropertyListEncoder</a>().</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">dataProvider</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="nv">encoder</span><span class="p">:</span> <span class="kt">JSONEncoder</span><span class="p">())</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() data received </span><span class="se">\(</span><span class="n">data</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">stringRepresentation</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">stringRepresentation</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like the <a href="#reference-decode">decode</a> operator, the encode process can also fail and throw an error, so it returns a failure type of Error.
With the compiler forcing type matching, the usual error condition is if you flow an optional value into the pipeline.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-decode">decode</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A very common operation is to want to use decode (or <a href="#reference-encode">encode</a> data in a pipline, so Combine provides an operator specifically suited to that task.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available when Output conforms to Decodable.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/decode" class="bare">https://developer.apple.com/documentation/combine/publishers/decode</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-dataTaskPublisher-decode">Pattern 2.1: Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-dataTaskPublisher-tryMap">Pattern 2.2: Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Pattern 3.2: Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Pattern 3.3: Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p>unit tests illustrating using encode and decode: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EncodeDecodeTests.swift"><code>UsingCombineTests/EncodeDecodeTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The decode operator takes two parameters:</p>
<div class="ulist">
<ul>
<li>
<p><code>type</code> which is typically a reference to a struct you&#8217;ve defined</p>
</li>
<li>
<p><code>decoder</code> an instance of an object conforming to <a href="https://developer.apple.com/documentation/combine/topleveldecoder">TopLevelDecoder</a>, frequently an instance of <a href="https://developer.apple.com/documentation/foundation/jsondecoder">JSONDecoder</a>() or <a href="https://developer.apple.com/documentation/foundation/propertylistdecoder">PropertyListDecoder</a>().</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Since decoding can fail, the operator will also return a failure type of Error.
The data type returned by the operator is defined by the type you provided to decode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">testUrlString</span> <span class="o">=</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span>
<span class="c1">// checks the validity of a timestamp - this one should return {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">testUrlString</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-multipleSubscribers">Working with multiple subscribers</h4>
<div class="sect4">
<h5 id="reference-multicast">multicast</h5>
<div class="ulist">
<ul>
<li>
<p>multicast</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-debugging">Debugging</h4>
<div class="sect4">
<h5 id="reference-breakpoint">breakpoint</h5>
<div class="ulist">
<ul>
<li>
<p>breakpoint</p>
<div class="ulist">
<ul>
<li>
<p>Raises a debugger signal when a provided closure needs to stop the process in the debugger.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-breakpointOnError">breakpointOnError</h5>
<div class="ulist">
<ul>
<li>
<p>breakpointOnError</p>
<div class="ulist">
<ul>
<li>
<p>Raises a debugger signal upon receiving a failure.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-handleEvents">handleEvents</h5>
<div class="ulist">
<ul>
<li>
<p>handleEvents</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-print">print</h5>
<div class="ulist">
<ul>
<li>
<p>print</p>
<div class="ulist">
<ul>
<li>
<p>Prints log messages for all publishing events.</p>
</li>
<li>
<p>requires Failure to be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="scheduler-and-thread-handling-operators">Scheduler and Thread handling operators</h4>
<div class="sect4">
<h5 id="reference-receive">receive</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Receive defines the scheduler on which to receive elememts from the publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publisher/3204743-receive"><code>receive</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</a> shows an example of using assign to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using an assign subscriber in a pipeline from a dataTaskPublisher with subscribe and receive: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Receive takes a single required parameter (<code>on:</code>) which accepts a scheduler, and an optional parameter (<code>optional:</code>) which can accept SchedulerOptions.
<a href="https://developer.apple.com/documentation/combine/scheduler">Scheduler</a> is a protocol in Combine, with the conforming types that are commonly used of <a href="https://developer.apple.com/documentation/foundation/runloop">RunLoop</a>, <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue</a> and <a href="https://developer.apple.com/documentation/foundation/operationqueue">OperationQueue</a>.
Receive is frequently used with <a href="#reference-assign">assign</a> to make sure any following pipeline invocations happen on a specific thread, such as <code>RunLoop.main</code> when updating user interface objects.
Receive effects itself and any opertors chained after it, but not previous operators.
If you want to influence previously chained publishers (or operators) for where to run, use the <a href="#reference-subscribe">subscribe</a> operator.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">examplePublisher</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Receive takes a single</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-subscribe">subscribe</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Subscribe defines the scheduler on which to run operators in a pipeline.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/anypublisher/3204260-subscribe"><code>subscribe</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</a> shows an example of using assign to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using an assign subscriber in a pipeline from a dataTaskPublisher with subscribe and receive: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Subscribe assigns a scheduler to any preceding pipeline invocations, and is often used to invoke a publisher on a background thread or queue. When used in this fashion, it is often used in coordination with <a href="#reference-receive">receive</a> to transfer data to another thread (such as the main runloop) for following operators or the subscriber.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Subscribe takes a single required parameter (<code>on:</code>) which accepts a scheduler, and an optional parameter (<code>optional:</code>) which can accept SchedulerOptions.
<a href="https://developer.apple.com/documentation/combine/scheduler">Scheduler</a> is a protocol in Combine, with the conforming types that are commonly used of <a href="https://developer.apple.com/documentation/foundation/runloop">RunLoop</a>, <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue</a> and <a href="https://developer.apple.com/documentation/foundation/operationqueue">OperationQueue</a>.</p>
</div>
<div class="paragraph">
<p>Subscribe effects itself and any opertors chained before it, but not following operators.
If you want to influence chained operators after subscribe for where to run, use the <a href="#reference-receive">receive</a> operator.
The most comon example of this is receiving on <code>RunLoop.main</code>, critical when updating user interface objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">networkDataPublisher</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourLabel</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>subscribe</code> call requests the publisher (and any pipeline invocations before this in a chain) be invoked on the backgroundQueue.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>receive</code> call transfers the data to the main runloop, suitable for updating user interface elements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>assign</code> call uses the <a href="#reference-assign">assign</a> subscriber to update the property <code>text</code> on a KVO compliant object, in this case <code>yourLabel</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When creating a DispatchQueue to use with Combine publishers on background threads, it is recommended that you use a regular serial queue rather than a concurrent queue <a href="https://forums.swift.org/t/runloop-main-or-dispatchqueue-main-when-using-combine-scheduler/26635/4">to allow Combine to adhere to its contracts</a>.
That is - don&#8217;t create the queue with <code>attributes: .concurrent</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="type-erasure-operators">Type erasure operators</h4>
<div class="sect4">
<h5 id="reference-eraseToAnyPublisher">eraseToAnyPublisher</h5>
<div class="ulist">
<ul>
<li>
<p>when you chain operators together in swift, the object&#8217;s type signature accumulates all the various types, and it gets ugly pretty quickly.</p>
</li>
<li>
<p>eraseToAnyPublisher takes the signature and "erases" the type back to the common type of AnyPublisher</p>
</li>
<li>
<p>this provides a cleaner type for external declarations (framework was created prior to Swift 5&#8217;s opaque types)</p>
</li>
<li>
<p><code>.eraseToAnyPublisher()</code></p>
</li>
<li>
<p>often at the end of chains of operators, and cleans up the type signature of the property getting asigned to the chain of operators</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="reference-eraseToAnySubscriber">eraseToAnySubscriber</h5>

</div>
<div class="sect4">
<h5 id="reference-eraseToAnySubject">eraseToAnySubject</h5>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reference-subjects">Subjects</h3>
<div class="sect3">
<h4 id="reference-currentValueSubject">currentValueSubject</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/currentvaluesubject"><code>CurrentValueSubject</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reference-passthroughSubject">PassthroughSubject</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/passthroughsubject"><code>PassthroughSubject</code></a></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="reference-subscribers">Subscribers</h3>
<div class="paragraph">
<p>For general information about subscribers and how they fit with publishers and operators, see <a href="#core-subscribers">Subscribers</a>.</p>
</div>
<div class="sect3">
<h4 id="reference-assign">assign</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Assign creates a subscriber used to update a property on a KVO compliant object.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Failure type must be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/subscribers/assign"><code>assign</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Pattern 1.2: Creating a subscriber with assign</a> shows an example of using assign to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using an assign subscriber in a pipeline from a dataTaskPublisher with subscribe and receive: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Assign only handles data, and expects all errors or failures to be handled in the pipeline before it is invoked.
The return value from setting up assign can be cancelled, and is frequently used when disabling the pipeline, such as when a viewController is disabled or deallocated.
Assign is frequently used in conjunction with the <a href="#reference-receive">receive</a> operator to receive values on a specific scheduler, typically <code>RunLoop.main</code> when updating UI objects.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">examplePublisher</span>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourLabel</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-sink">sink</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Sink creates an all-purpose subscriber.
At a minimum, you provide a closure to receive values, and optionally a closure that receives completions.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/subscribers/sink"><code>sink</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-sink-subscriber">Pattern 1.1: Creating a subscriber with sink</a> shows an example of creating a sink that receives both completion messages as well as data from the publisher.</p>
</li>
<li>
<p>unit tests illustrating a sink subscriber and how it works: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SinkSubscriberTests.swift"><code>UsingCombineTests/SinkSubscriberTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The simplest form of <code>.sink()</code> takes a single closure - by default this closure receives data (if provided by the attached publisher).</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">examplePublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">examplePublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The closure you provide is invoked for every update that the publisher passes down, up until the completion.
Be aware that the single closure form may be called repeatedly.
How often it is called depends on the pipeline to which it is subscribing.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t also include a closure to get the completion, you will not receive any information about failures.
If an error or failure occurs and is handed down from the publisher the single closure form will not be called.</p>
</div>
<div class="paragraph">
<p>If you are creating a subscriber and want to receive failures, or see the completion messages at the end of pipeline, create a sink with two closures.
The more complete sink has the two closures named <code>receiveCompletion</code> and <code>receiveValue</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">examplePublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">examplePublisher</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">err</span><span class="p">))</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type that is passed into receiveCompletion is the enum <a href="https://developer.apple.com/documentation/combine/subscribers/completion"><code>Subscribers.Completion</code></a>.
The completion <code>.failure</code> incudes an Error wrapped within it, providing access to the underlying cause of the failure.
To get to the error within the <code>.failure</code> completion, <code>switch</code> on the returned completion to determine if it is <code>.finished</code> or <code>.failure</code>, and then pull out the error.</p>
</div>
<div class="paragraph">
<p>When you chain a <code>.sink</code> subscriber onto a publisher (or pipeline), the result is cancellable.
At any time before the publisher sends a completion, the subscriber can send a cancellation and invalidate the pipeline.
After a cancel is sent, no further values will be received by either closure in the sink.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">simplePublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">simplePublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
  <span class="c1">// do what you need with the data...</span>
<span class="p">}</span>

<span class="n">cancellablePublisher</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <span class="c1">// this invalidates the pipeline, no further data will be received by the sink</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.3<br>
Last updated 2019-07-07 17:21:23 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-898243-5','auto');
ga('send','pageview');
</script>
</body>
</html>